!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.RpcBuilder=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
function Mapper(){var r={};this.forEach=function(e){for(var i in r){var o=r[i];for(var t in o)e(o[t])}},this.get=function(e,i){var o=r[i];return void 0==o?void 0:o[e]},this.remove=function(e,i){var o=r[i];if(void 0!=o){delete o[e];for(var t in o)return!1;delete r[i]}},this.set=function(e,i,o){if(void 0==e)return this.remove(i,o);var t=r[o];void 0==t&&(r[o]=t={}),t[i]=e}}Mapper.prototype.pop=function(r,e){var i=this.get(r,e);return void 0==i?void 0:(this.remove(r,e),i)},module.exports=Mapper;
//# sourceMappingURL=kurento-jsonrpc.map
},{}],2:[function(_dereq_,module,exports){
var JsonRpcClient=_dereq_("./jsonrpcclient");exports.JsonRpcClient=JsonRpcClient;
//# sourceMappingURL=kurento-jsonrpc.map
},{"./jsonrpcclient":3}],3:[function(_dereq_,module,exports){
function JsonRpcClient(e,r,n){var i=new WebSocket(e);i.addEventListener("error",n);var s=new RpcBuilder(RpcBuilder.packers.JsonRPC,i,r);this.close=s.close.bind(s),this.sendRequest=s.encode.bind(s)}var RpcBuilder=_dereq_("../.."),WebSocket=_dereq_("ws");module.exports=JsonRpcClient;
//# sourceMappingURL=kurento-jsonrpc.map
},{"../..":4,"ws":10}],4:[function(_dereq_,module,exports){
function unifyResponseMethods(e){if(!e)return{};for(var t in e){var r=e[t];"string"==typeof r&&(e[t]={response:r})}return e}function unifyTransport(e){if(e){if(e instanceof Function)return{send:e};if(e.send instanceof Function)return e;if(e.postMessage instanceof Function)return e.send=e.postMessage,e;if(e.write instanceof Function)return e.send=e.write,e;if(void 0===e.onmessage&&!(e.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function RpcNotification(e,t){defineProperty_IE8?(this.method=e,this.params=t):(Object.defineProperty(this,"method",{value:e,enumerable:!0}),Object.defineProperty(this,"params",{value:t,enumerable:!0}))}function RpcBuilder(e,t,r,n){function i(e){f.decode(e.data||e)}function o(e,t,r){var n={message:e,timeout:setTimeout(function(){y.remove(t,r)},l)};y.set(n,t,r)}function s(e,t){var r=setTimeout(function(){T.remove(e,t)},v);T.set(r,e,t)}function a(t,r,n,i,s){RpcNotification.call(this,t,r),this.getTransport=function(){return s},this.setTransport=function(e){s=unifyTransport(e)},defineProperty_IE8||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var a=y.get(n,i);s||f.getTransport()||(defineProperty_IE8?this.duplicated=Boolean(a):Object.defineProperty(this,"duplicated",{value:Boolean(a)}));var c=u[t];this.pack=e.pack.bind(e,this,n),this.reply=function(t,r,s){if(t instanceof Function||t&&t.send instanceof Function){if(void 0!=r)throw new SyntaxError("There can't be parameters after callback");s=t,r=null,t=void 0}else if(r instanceof Function||r&&r.send instanceof Function){if(void 0!=s)throw new SyntaxError("There can't be parameters after callback");s=r,r=null}s=unifyTransport(s),a&&clearTimeout(a.timeout),void 0!=i&&(t&&(t.dest=i),r&&(r.dest=i));var u;if(t||void 0!=r){if(void 0!=f.peerID&&(t?t.from=f.peerID:r.from=f.peerID),c)if(void 0==c.error&&t)u={error:t};else{var p=t?c.error:c.response;u={method:p,params:t||r}}else u={error:t,result:r};u=e.pack(u,n)}else u=a?a.message:e.pack({result:null},n);return o(u,n,i),s=s||this.getTransport()||f.getTransport(),s?s.send(u):u}}function c(e){var t=E[e];if(t){delete E[e];var r=m.pop(t.id,t.dest);r&&(clearTimeout(r.timeout),s(t.id,t.dest))}}var f=this;if(!e)throw new SyntaxError("Packer is not defined");if(!e.pack||!e.unpack)throw new SyntaxError("Packer is invalid");var u=unifyResponseMethods(e.responseMethods);if(t instanceof Function){if(void 0!=r)throw new SyntaxError("There can't be parameters after onRequest");n=t,r=void 0,t=void 0}if(t&&t.send instanceof Function){if(r&&!(r instanceof Function))throw new SyntaxError("Only a function can be after transport");n=r,r=t,t=void 0}if(r instanceof Function){if(void 0!=n)throw new SyntaxError("There can't be parameters after onRequest");n=r,r=void 0}if(r&&r.send instanceof Function&&n&&!(n instanceof Function))throw new SyntaxError("Only a function can be after transport");t=t||{},EventEmitter.call(this),n&&this.on("request",n),defineProperty_IE8?this.peerID=t.peerID:Object.defineProperty(this,"peerID",{value:t.peerID});var p=t.max_retries||0;this.getTransport=function(){return r},this.setTransport=function(e){r&&(r.removeEventListener?r.removeEventListener("message",i):r.removeListener&&r.removeListener("data",i)),e&&(e.addEventListener?e.addEventListener("message",i):e.addListener&&e.addListener("data",i)),r=unifyTransport(e)},defineProperty_IE8||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(r);var d=t.request_timeout||BASE_TIMEOUT,l=t.response_timeout||BASE_TIMEOUT,v=t.duplicates_timeout||BASE_TIMEOUT,h=0,m=new Mapper,y=new Mapper,T=new Mapper,E={};inherits(a,RpcNotification),this.cancel=function(e){if(e)return c(e);for(var e in E)c(e)},this.close=function(){var e=this.getTransport();e&&e.close&&e.close(),this.cancel(),T.forEach(clearTimeout),y.forEach(function(e){clearTimeout(e.timeout)})},this.encode=function(t,r,n,i,o){function s(e,t){f.cancel(v),o(e,t)}function a(e){return b.timeout=setTimeout(l,d*Math.pow(2,w++)),E[v]={id:y,dest:n},m.set(b,y,n),e=e||g||f.getTransport(),e?e.send(v):v}function c(e){e=unifyTransport(e),console.warn(w+" retry for request message:",v);var t=T.pop(y,n);return clearTimeout(t),a(e)}function l(){if(p>w)return c(i);var e=new Error("Request has timed out");e.request=v,e.retry=c,s(e)}if(r instanceof Function){if(void 0!=n)throw new SyntaxError("There can't be parameters after callback");o=r,i=void 0,n=void 0,r=void 0}else if(n instanceof Function){if(void 0!=i)throw new SyntaxError("There can't be parameters after callback");o=n,i=void 0,n=void 0}else if(i instanceof Function){if(void 0!=o)throw new SyntaxError("There can't be parameters after callback");o=i,i=void 0}void 0!=f.peerID&&(r=r||{},r.from=f.peerID),void 0!=n&&(r=r||{},r.dest=n);var v={method:t,params:r};if(o){var y=h++,w=0;v=e.pack(v,y);var b={message:v,callback:s,responseMethods:u[t]||{}},g=unifyTransport(i);return a(i)}return v=e.pack(v),i=i||this.getTransport(),i?i.send(v):v},this.decode=function(t,r){function n(){if(r=unifyTransport(r)||f.getTransport()){var e=y.get(u,v);if(e)return r.send(e.message)}var t=void 0!=u?u:p,n=new a(d,l,t,v,r);return f.emit("request",n)?void 0:n}function i(e,t,r){e.callback(t,r)}function o(e){console.warn("Response already processed",t),clearTimeout(e),s(p,v)}if(!t)throw new TypeError("Message is not defined");try{t=e.unpack(t)}catch(c){return console.debug(c,t)}var u=t.id,p=t.ack,d=t.method,l=t.params||{},v=l.from,h=l.dest;if(void 0==f.peerID||v!=f.peerID){if(void 0==u&&void 0==p){var E=new RpcNotification(d,l);if(f.emit("request",E))return;return E}if(d){if(void 0==h||h==f.peerID){var w=m.get(p,v);if(w){var b=w.responseMethods;return d==b.error?i(w,l):d==b.response?i(w,null,l):n()}var g=T.get(p,v);if(g)return o(g)}return n()}var I=t.error,k=t.result;if(!(I&&I.dest&&I.dest!=f.peerID||k&&k.dest&&k.dest!=f.peerID)){var w=m.get(p,v);if(!w){var g=T.get(p,v);return g?o(g):console.warn("No callback was defined for this message",t)}i(w,I,k)}}}}var defineProperty_IE8=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(e){defineProperty_IE8=!0}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),r=this,n=function(){},i=function(){return r.apply(this instanceof n&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,i.prototype=new n,i});var EventEmitter=_dereq_("events").EventEmitter,inherits=_dereq_("inherits"),packers=_dereq_("./packers"),Mapper=_dereq_("./Mapper"),BASE_TIMEOUT=5e3;inherits(RpcBuilder,EventEmitter),RpcBuilder.RpcNotification=RpcNotification,module.exports=RpcBuilder;var clients=_dereq_("./clients");RpcBuilder.clients=clients,RpcBuilder.packers=packers;
//# sourceMappingURL=kurento-jsonrpc.map
},{"./Mapper":1,"./clients":2,"./packers":7,"events":8,"inherits":9}],5:[function(_dereq_,module,exports){
function pack(r,e){var o={jsonrpc:"2.0"};if(r.method)o.method=r.method,r.params&&(o.params=r.params),void 0!=e&&(o.id=e);else if(void 0!=e){if(r.error){if(void 0!==r.result)throw new TypeError("Both result and error are defined");o.error=r.error}else{if(void 0===r.result)throw new TypeError("No result or error is defined");o.result=r.result}o.id=e}return JSON.stringify(o)}function unpack(r){var e=r;("string"==typeof r||r instanceof String)&&(e=JSON.parse(r));var o=e.jsonrpc;if("2.0"!=o)throw new TypeError("Invalid JsonRPC version '"+o+"': "+r);if(void 0==e.method){if(void 0==e.id)throw new TypeError("Invalid message: "+r);var i=void 0!==e.result,t=void 0!==e.error;if(i&&t)throw new TypeError("Both result and error are defined: "+r);if(!i&&!t)throw new TypeError("No result or error is defined: "+r);e.ack=e.id,delete e.id}return e}exports.pack=pack,exports.unpack=unpack;
//# sourceMappingURL=kurento-jsonrpc.map
},{}],6:[function(_dereq_,module,exports){
function pack(e){throw new TypeError("Not yet implemented")}function unpack(e){throw new TypeError("Not yet implemented")}exports.pack=pack,exports.unpack=unpack;
//# sourceMappingURL=kurento-jsonrpc.map
},{}],7:[function(_dereq_,module,exports){
var JsonRPC=_dereq_("./JsonRPC"),XmlRPC=_dereq_("./XmlRPC");exports.JsonRPC=JsonRPC,exports.XmlRPC=XmlRPC;
//# sourceMappingURL=kurento-jsonrpc.map
},{"./JsonRPC":5,"./XmlRPC":6}],8:[function(_dereq_,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};
//# sourceMappingURL=kurento-jsonrpc.map
},{}],9:[function(_dereq_,module,exports){
module.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
//# sourceMappingURL=kurento-jsonrpc.map
},{}],10:[function(_dereq_,module,exports){
function ws(e,o,t){var b;return b=o?new WebSocket(e,o):new WebSocket(e)}var global=function(){return this}(),WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null,WebSocket&&(ws.prototype=WebSocket.prototype);
//# sourceMappingURL=kurento-jsonrpc.map
},{}]},{},[4])

(4)
});

//# sourceMappingURL=kurento-jsonrpc.map