{"version":3,"file":"bundle.js","sources":["../node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","../lib/index.js","../lib/Mapper.js","../node_modules/grunt-browserify/node_modules/browserify/node_modules/events/events.js","../lib/packers/index.js","../lib/clients/index.js","../lib/clients/jsonrpcclient.js","../lib/packers/XmlRPC.js","../lib/packers/JsonRPC.js","../node_modules/inherits/inherits_browser.js","../node_modules/ws/lib/browser.js"],"names":["unifyResponseMethods","responseMethods","key","value","response","unifyTransport","transport","Function","send","postMessage","write","undefined","onmessage","pause","SyntaxError","RpcNotification","method","params","defineProperty_IE8","this","Object","defineProperty","enumerable","RpcBuilder","packer","options","onRequest","transportMessage","event","self","decode","data","storeResponse","message","id","dest","timeout","setTimeout","responses","remove","response_timeout","set","storeProcessedResponse","ack","from","processedResponses","duplicates_timeout","RpcRequest","call","getTransport","setTransport","get","bind","duplicated","Boolean","responseMethod","pack","reply","error","result","clearTimeout","peerID","cancel","message2Key","request","requests","pop","unpack","EventEmitter","on","max_retries","removeEventListener","removeListener","addEventListener","addListener","request_timeout","BASE_TIMEOUT","requestID","Mapper","inherits","close","forEach","encode","callback","dispatchCallback","sendRequest","Math","pow","retried","encode_transport","retry","console","warn","Error","processRequest","idAck","emit","processResponse","duplicatedResponse","TypeError","e","debug","notification","processed","prototype","oThis","aArgs","Array","slice","arguments","fToBind","fNOP","fBound","apply","concat","require","packers","module","exports","clients","sources","source","key2","ids","i","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","type","er","handler","len","args","listeners","length","listener","m","newListener","push","warned","trace","once","g","fired","list","position","splice","removeAllListeners","ret","listenerCount","emitter","JsonRPC","XmlRPC","JsonRpcClient","wsUrl","onerror","ws","WebSocket","rpc","jsonrpc","JSON","stringify","String","parse","version","result_defined","error_defined","create","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","uri","protocols","opts","instance","global","MozWebSocket"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\n\nvar defineProperty_IE8 = false\nif(Object.defineProperty)\n{\n  try\n  {\n    Object.defineProperty({}, \"x\", {});\n  }\n  catch(e)\n  {\n    defineProperty_IE8 = true\n  }\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function(oThis) {\n    if (typeof this !== 'function') {\n      // closest thing possible to the ECMAScript 5\n      // internal IsCallable function\n      throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n    }\n\n    var aArgs   = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP    = function() {},\n        fBound  = function() {\n          return fToBind.apply(this instanceof fNOP && oThis\n                 ? this\n                 : oThis,\n                 aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n\n    return fBound;\n  };\n}\n\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar inherits = require('inherits');\n\nvar packers = require('./packers');\nvar Mapper = require('./Mapper');\n\n\nvar BASE_TIMEOUT = 5000;\n\n\nfunction unifyResponseMethods(responseMethods)\n{\n  if(!responseMethods) return {};\n\n  for(var key in responseMethods)\n  {\n    var value = responseMethods[key];\n\n    if(typeof value == 'string')\n      responseMethods[key] =\n      {\n        response: value\n      }\n  };\n\n  return responseMethods;\n};\n\nfunction unifyTransport(transport)\n{\n  if(!transport) return;\n\n  // Transport as a function\n  if(transport instanceof Function)\n    return {send: transport};\n\n  // WebSocket & DataChannel\n  if(transport.send instanceof Function)\n    return transport;\n\n  // Message API (Inter-window & WebWorker)\n  if(transport.postMessage instanceof Function)\n  {\n    transport.send = transport.postMessage;\n    return transport;\n  }\n\n  // Stream API\n  if(transport.write instanceof Function)\n  {\n    transport.send = transport.write;\n    return transport;\n  }\n\n  // Transports that only can receive messages, but not send\n  if(transport.onmessage !== undefined) return;\n  if(transport.pause instanceof Function) return;\n\n  throw new SyntaxError(\"Transport is not a function nor a valid object\");\n};\n\n\n/**\n * Representation of a RPC notification\n *\n * @class\n *\n * @constructor\n *\n * @param {String} method -method of the notification\n * @param params - parameters of the notification\n */\nfunction RpcNotification(method, params)\n{\n  if(defineProperty_IE8)\n  {\n    this.method = method\n    this.params = params\n  }\n  else\n  {\n    Object.defineProperty(this, 'method', {value: method, enumerable: true});\n    Object.defineProperty(this, 'params', {value: params, enumerable: true});\n  }\n};\n\n\n/**\n * @class\n *\n * @constructor\n *\n * @param {object} packer\n *\n * @param {object} [options]\n *\n * @param {object} [transport]\n *\n * @param {Function} [onRequest]\n */\nfunction RpcBuilder(packer, options, transport, onRequest)\n{\n  var self = this;\n\n  if(!packer)\n    throw new SyntaxError('Packer is not defined');\n\n  if(!packer.pack || !packer.unpack)\n    throw new SyntaxError('Packer is invalid');\n\n  var responseMethods = unifyResponseMethods(packer.responseMethods);\n\n\n  if(options instanceof Function)\n  {\n    if(transport != undefined)\n      throw new SyntaxError(\"There can't be parameters after onRequest\");\n\n    onRequest = options;\n    transport = undefined;\n    options   = undefined;\n  };\n\n  if(options && options.send instanceof Function)\n  {\n    if(transport && !(transport instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n    onRequest = transport;\n    transport = options;\n    options   = undefined;\n  };\n\n  if(transport instanceof Function)\n  {\n    if(onRequest != undefined)\n      throw new SyntaxError(\"There can't be parameters after onRequest\");\n\n    onRequest = transport;\n    transport = undefined;\n  };\n\n  if(transport && transport.send instanceof Function)\n    if(onRequest && !(onRequest instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n  options = options || {};\n\n\n  EventEmitter.call(this);\n\n  if(onRequest)\n    this.on('request', onRequest);\n\n\n  if(defineProperty_IE8)\n    this.peerID = options.peerID\n  else\n    Object.defineProperty(this, 'peerID', {value: options.peerID});\n\n  var max_retries = options.max_retries || 0;\n\n\n  function transportMessage(event)\n  {\n    self.decode(event.data || event);\n  };\n\n  this.getTransport = function()\n  {\n    return transport;\n  }\n  this.setTransport = function(value)\n  {\n    // Remove listener from old transport\n    if(transport)\n    {\n      // W3C transports\n      if(transport.removeEventListener)\n        transport.removeEventListener('message', transportMessage);\n\n      // Node.js Streams API\n      else if(transport.removeListener)\n        transport.removeListener('data', transportMessage);\n    };\n\n    // Set listener on new transport\n    if(value)\n    {\n      // W3C transports\n      if(value.addEventListener)\n        value.addEventListener('message', transportMessage);\n\n      // Node.js Streams API\n      else if(value.addListener)\n        value.addListener('data', transportMessage);\n    };\n\n    transport = unifyTransport(value);\n  }\n\n  if(!defineProperty_IE8)\n    Object.defineProperty(this, 'transport',\n    {\n      get: this.getTransport.bind(this),\n      set: this.setTransport.bind(this)\n    })\n\n  this.setTransport(transport);\n\n\n  var request_timeout    = options.request_timeout    || BASE_TIMEOUT;\n  var response_timeout   = options.response_timeout   || BASE_TIMEOUT;\n  var duplicates_timeout = options.duplicates_timeout || BASE_TIMEOUT;\n\n\n  var requestID = 0;\n\n  var requests  = new Mapper();\n  var responses = new Mapper();\n  var processedResponses = new Mapper();\n\n  var message2Key = {};\n\n\n  /**\n   * Store the response to prevent to process duplicate request later\n   */\n  function storeResponse(message, id, dest)\n  {\n    var response =\n    {\n      message: message,\n      /** Timeout to auto-clean old responses */\n      timeout: setTimeout(function()\n      {\n        responses.remove(id, dest);\n      },\n      response_timeout)\n    };\n\n    responses.set(response, id, dest);\n  };\n\n  /**\n   * Store the response to ignore duplicated messages later\n   */\n  function storeProcessedResponse(ack, from)\n  {\n    var timeout = setTimeout(function()\n    {\n      processedResponses.remove(ack, from);\n    },\n    duplicates_timeout);\n\n    processedResponses.set(timeout, ack, from);\n  };\n\n\n  /**\n   * Representation of a RPC request\n   *\n   * @class\n   * @extends RpcNotification\n   *\n   * @constructor\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param {Integer} id - identifier of the request\n   * @param [from] - source of the notification\n   */\n  function RpcRequest(method, params, id, from, transport)\n  {\n    RpcNotification.call(this, method, params);\n\n    this.getTransport = function()\n    {\n      return transport;\n    }\n    this.setTransport = function(value)\n    {\n      transport = unifyTransport(value);\n    }\n\n    if(!defineProperty_IE8)\n      Object.defineProperty(this, 'transport',\n      {\n        get: this.getTransport.bind(this),\n        set: this.setTransport.bind(this)\n      })\n\n    var response = responses.get(id, from);\n\n    /**\n     * @constant {Boolean} duplicated\n     */\n    if(!(transport || self.getTransport()))\n    {\n      if(defineProperty_IE8)\n        this.duplicated = Boolean(response)\n      else\n        Object.defineProperty(this, 'duplicated',\n        {\n          value: Boolean(response)\n        });\n    }\n\n    var responseMethod = responseMethods[method];\n\n    this.pack = packer.pack.bind(packer, this, id)\n\n    /**\n     * Generate a response to this request\n     *\n     * @param {Error} [error]\n     * @param {*} [result]\n     *\n     * @returns {string}\n     */\n    this.reply = function(error, result, transport)\n    {\n      // Fix optional parameters\n      if(error instanceof Function || error && error.send instanceof Function)\n      {\n        if(result != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = error;\n        result = null;\n        error = undefined;\n      }\n\n      else if(result instanceof Function\n      || result && result.send instanceof Function)\n      {\n        if(transport != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = result;\n        result = null;\n      };\n\n      transport = unifyTransport(transport);\n\n      // Duplicated request, remove old response timeout\n      if(response)\n        clearTimeout(response.timeout);\n\n      if(from != undefined)\n      {\n        if(error)\n          error.dest = from;\n\n        if(result)\n          result.dest = from;\n      };\n\n      var message;\n\n      // New request or overriden one, create new response with provided data\n      if(error || result != undefined)\n      {\n        if(self.peerID != undefined)\n        {\n          if(error)\n            error.from = self.peerID;\n          else\n            result.from = self.peerID;\n        }\n\n        // Protocol indicates that responses has own request methods\n        if(responseMethod)\n        {\n          if(responseMethod.error == undefined && error)\n            message =\n            {\n              error: error\n            };\n\n          else\n          {\n            var method = error\n                       ? responseMethod.error\n                       : responseMethod.response;\n\n            message =\n            {\n              method: method,\n              params: error || result\n            };\n          }\n        }\n        else\n          message =\n          {\n            error:  error,\n            result: result\n          };\n\n        message = packer.pack(message, id);\n      }\n\n      // Duplicate & not-overriden request, re-send old response\n      else if(response)\n        message = response.message;\n\n      // New empty reply, response null value\n      else\n        message = packer.pack({result: null}, id);\n\n      // Store the response to prevent to process a duplicated request later\n      storeResponse(message, id, from);\n\n      // Return the stored response so it can be directly send back\n      transport = transport || this.getTransport() || self.getTransport();\n\n      if(transport)\n        return transport.send(message);\n\n      return message;\n    }\n  };\n  inherits(RpcRequest, RpcNotification);\n\n\n  function cancel(message)\n  {\n    var key = message2Key[message];\n    if(!key) return;\n\n    delete message2Key[message];\n\n    var request = requests.pop(key.id, key.dest);\n    if(!request) return;\n\n    clearTimeout(request.timeout);\n\n    // Start duplicated responses timeout\n    storeProcessedResponse(key.id, key.dest);\n  };\n\n  /**\n   * Allow to cancel a request and don't wait for a response\n   *\n   * If `message` is not given, cancel all the request\n   */\n  this.cancel = function(message)\n  {\n    if(message) return cancel(message);\n\n    for(var message in message2Key)\n      cancel(message);\n  };\n\n\n  this.close = function()\n  {\n    // Prevent to receive new messages\n    var transport = this.getTransport();\n    if(transport && transport.close)\n       transport.close();\n\n    // Request & processed responses\n    this.cancel();\n\n    processedResponses.forEach(clearTimeout);\n\n    // Responses\n    responses.forEach(function(response)\n    {\n      clearTimeout(response.timeout);\n    });\n  };\n\n\n  /**\n   * Generates and encode a JsonRPC 2.0 message\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param [dest] - destination of the notification\n   * @param {object} [transport] - transport where to send the message\n   * @param [callback] - function called when a response to this request is\n   *   received. If not defined, a notification will be send instead\n   *\n   * @returns {string} A raw JsonRPC 2.0 request or notification string\n   */\n  this.encode = function(method, params, dest, transport, callback)\n  {\n    // Fix optional parameters\n    if(params instanceof Function)\n    {\n      if(dest != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = params;\n      transport = undefined;\n      dest      = undefined;\n      params    = undefined;\n    }\n\n    else if(dest instanceof Function)\n    {\n      if(transport != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = dest;\n      transport = undefined;\n      dest      = undefined;\n    }\n\n    else if(transport instanceof Function)\n    {\n      if(callback != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = transport;\n      transport = undefined;\n    };\n\n    if(self.peerID != undefined)\n    {\n      params = params || {};\n\n      params.from = self.peerID;\n    };\n\n    if(dest != undefined)\n    {\n      params = params || {};\n\n      params.dest = dest;\n    };\n\n    // Encode message\n    var message =\n    {\n      method: method,\n      params: params\n    };\n\n    if(callback)\n    {\n      var id = requestID++;\n      var retried = 0;\n\n      message = packer.pack(message, id);\n\n      function dispatchCallback(error, result)\n      {\n        self.cancel(message);\n\n        callback(error, result);\n      };\n\n      var request =\n      {\n        message:         message,\n        callback:        dispatchCallback,\n        responseMethods: responseMethods[method] || {}\n      };\n\n      var encode_transport = unifyTransport(transport);\n\n      function sendRequest(transport)\n      {\n        request.timeout = setTimeout(timeout,\n                                     request_timeout*Math.pow(2, retried++));\n        message2Key[message] = {id: id, dest: dest};\n        requests.set(request, id, dest);\n\n        transport = transport || encode_transport || self.getTransport();\n        if(transport)\n          return transport.send(message);\n\n        return message;\n      };\n\n      function retry(transport)\n      {\n        transport = unifyTransport(transport);\n\n        console.warn(retried+' retry for request message:',message);\n\n        var timeout = processedResponses.pop(id, dest);\n        clearTimeout(timeout);\n\n        return sendRequest(transport);\n      };\n\n      function timeout()\n      {\n        if(retried < max_retries)\n          return retry(transport);\n\n        var error = new Error('Request has timed out');\n            error.request = message;\n\n        error.retry = retry;\n\n        dispatchCallback(error)\n      };\n\n      return sendRequest(transport);\n    };\n\n    // Return the packed message\n    message = packer.pack(message);\n\n    transport = transport || this.getTransport();\n    if(transport)\n      return transport.send(message);\n\n    return message;\n  };\n\n  /**\n   * Decode and process a JsonRPC 2.0 message\n   *\n   * @param {string} message - string with the content of the message\n   *\n   * @returns {RpcNotification|RpcRequest|undefined} - the representation of the\n   *   notification or the request. If a response was processed, it will return\n   *   `undefined` to notify that it was processed\n   *\n   * @throws {TypeError} - Message is not defined\n   */\n  this.decode = function(message, transport)\n  {\n    if(!message)\n      throw new TypeError(\"Message is not defined\");\n\n    try\n    {\n      message = packer.unpack(message);\n    }\n    catch(e)\n    {\n      // Ignore invalid messages\n      return console.debug(e, message);\n    };\n\n    var id     = message.id;\n    var ack    = message.ack;\n    var method = message.method;\n    var params = message.params || {};\n\n    var from = params.from;\n    var dest = params.dest;\n\n    // Ignore messages send by us\n    if(self.peerID != undefined && from == self.peerID) return;\n\n    // Notification\n    if(id == undefined && ack == undefined)\n    {\n      var notification = new RpcNotification(method, params);\n\n      if(self.emit('request', notification)) return;\n      return notification;\n    };\n\n\n    function processRequest()\n    {\n      // If we have a transport and it's a duplicated request, reply inmediatly\n      transport = unifyTransport(transport) || self.getTransport();\n      if(transport)\n      {\n        var response = responses.get(id, from);\n        if(response)\n          return transport.send(response.message);\n      };\n\n      var idAck = (id != undefined) ? id : ack;\n      var request = new RpcRequest(method, params, idAck, from, transport);\n\n      if(self.emit('request', request)) return;\n      return request;\n    };\n\n    function processResponse(request, error, result)\n    {\n      request.callback(error, result);\n    };\n\n    function duplicatedResponse(timeout)\n    {\n      console.warn(\"Response already processed\", message);\n\n      // Update duplicated responses timeout\n      clearTimeout(timeout);\n      storeProcessedResponse(ack, from);\n    };\n\n\n    // Request, or response with own method\n    if(method)\n    {\n      // Check if it's a response with own method\n      if(dest == undefined || dest == self.peerID)\n      {\n        var request = requests.get(ack, from);\n        if(request)\n        {\n          var responseMethods = request.responseMethods;\n\n          if(method == responseMethods.error)\n            return processResponse(request, params);\n\n          if(method == responseMethods.response)\n            return processResponse(request, null, params);\n\n          return processRequest();\n        }\n\n        var processed = processedResponses.get(ack, from);\n        if(processed)\n          return duplicatedResponse(processed);\n      }\n\n      // Request\n      return processRequest();\n    };\n\n    var error  = message.error;\n    var result = message.result;\n\n    // Ignore responses not send to us\n    if(error  && error.dest  && error.dest  != self.peerID) return;\n    if(result && result.dest && result.dest != self.peerID) return;\n\n    // Response\n    var request = requests.get(ack, from);\n    if(!request)\n    {\n      var processed = processedResponses.get(ack, from);\n      if(processed)\n        return duplicatedResponse(processed);\n\n      return console.warn(\"No callback was defined for this message\", message);\n    };\n\n    // Process response\n    processResponse(request, error, result);\n  };\n};\ninherits(RpcBuilder, EventEmitter);\n\n\nRpcBuilder.RpcNotification = RpcNotification;\n\n\nmodule.exports = RpcBuilder;\n\nvar clients = require('./clients');\n\nRpcBuilder.clients = clients;\nRpcBuilder.packers = packers;\n","function Mapper()\n{\n  var sources = {};\n\n\n  this.forEach = function(callback)\n  {\n    for(var key in sources)\n    {\n      var source = sources[key];\n\n      for(var key2 in source)\n        callback(source[key2]);\n    };\n  };\n\n  this.get = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return undefined;\n\n    return ids[id];\n  };\n\n  this.remove = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return;\n\n    delete ids[id];\n\n    // Check it's empty\n    for(var i in ids){return false}\n\n    delete sources[source];\n  };\n\n  this.set = function(value, id, source)\n  {\n    if(value == undefined)\n      return this.remove(id, source);\n\n    var ids = sources[source];\n    if(ids == undefined)\n      sources[source] = ids = {};\n\n    ids[id] = value;\n  };\n};\n\n\nMapper.prototype.pop = function(id, source)\n{\n  var value = this.get(id, source);\n  if(value == undefined)\n    return undefined;\n\n  this.remove(id, source);\n\n  return value;\n};\n\n\nmodule.exports = Mapper;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var JsonRPC = require('./JsonRPC');\nvar XmlRPC  = require('./XmlRPC');\n\n\nexports.JsonRPC = JsonRPC;\nexports.XmlRPC  = XmlRPC;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\nvar JsonRpcClient  = require('./jsonrpcclient');\n\n\nexports.JsonRpcClient  = JsonRpcClient;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\nvar RpcBuilder = require('../..');\n\nvar WebSocket = require('ws');\n\n\nfunction JsonRpcClient(wsUrl, onRequest, onerror)\n{\n  var ws = new WebSocket(wsUrl);\n      ws.addEventListener('error', onerror);\n\n  var rpc = new RpcBuilder(RpcBuilder.packers.JsonRPC, ws, onRequest);\n\n  this.close       = rpc.close.bind(rpc);\n  this.sendRequest = rpc.encode.bind(rpc);\n};\n\n\nmodule.exports  = JsonRpcClient;\n","function pack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\nfunction unpack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","/**\n * JsonRPC 2.0 packer\n */\n\n/**\n * Pack a JsonRPC 2.0 message\n *\n * @param {Object} message - object to be packaged. It requires to have all the\n *   fields needed by the JsonRPC 2.0 message that it's going to be generated\n *\n * @return {String} - the stringified JsonRPC 2.0 message\n */\nfunction pack(message, id)\n{\n  var result =\n  {\n    jsonrpc: \"2.0\"\n  };\n\n  // Request\n  if(message.method)\n  {\n    result.method = message.method;\n\n    if(message.params)\n      result.params = message.params;\n\n    // Request is a notification\n    if(id != undefined)\n      result.id = id;\n  }\n\n  // Response\n  else if(id != undefined)\n  {\n    if(message.error)\n    {\n      if(message.result !== undefined)\n        throw new TypeError(\"Both result and error are defined\");\n\n      result.error = message.error;\n    }\n    else if(message.result !== undefined)\n      result.result = message.result;\n    else\n      throw new TypeError(\"No result or error is defined\");\n\n    result.id = id;\n  };\n\n  return JSON.stringify(result);\n};\n\n/**\n * Unpack a JsonRPC 2.0 message\n *\n * @param {String} message - string with the content of the JsonRPC 2.0 message\n *\n * @throws {TypeError} - Invalid JsonRPC version\n *\n * @return {Object} - object filled with the JsonRPC 2.0 message content\n */\nfunction unpack(message)\n{\n  var result = message;\n\n  if(typeof message == 'string' || message instanceof String)\n    result = JSON.parse(message);\n\n  // Check if it's a valid message\n\n  var version = result.jsonrpc;\n  if(version != \"2.0\")\n    throw new TypeError(\"Invalid JsonRPC version '\"+version+\"': \"+message);\n\n  // Response\n  if(result.method == undefined)\n  {\n    if(result.id == undefined)\n      throw new TypeError(\"Invalid message: \"+message);\n\n    var result_defined = result.result !== undefined;\n    var error_defined  = result.error  !== undefined;\n\n    // Check only result or error is defined, not both or none\n    if(result_defined && error_defined)\n      throw new TypeError(\"Both result and error are defined: \"+message);\n\n    if(!result_defined && !error_defined)\n      throw new TypeError(\"No result or error is defined: \"+message);\n\n    result.ack = result.id;\n    delete result.id;\n  }\n\n  // Return unpacked message\n  return result;\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n"]}