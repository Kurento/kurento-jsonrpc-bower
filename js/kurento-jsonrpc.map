{"version":3,"sources":["../node_modules/browser-pack/_prelude.js","../lib/Mapper.js","../lib/clients/index.js","../lib/clients/jsonrpcclient.js","../lib/clients/transports/index.js","../lib/clients/transports/webSocketWithReconnection.js","../lib/index.js","../lib/packers/JsonRPC.js","../lib/packers/XmlRPC.js","../lib/packers/index.js","../node_modules/events/events.js","../node_modules/inherits/inherits_browser.js"],"names":["Mapper","sources","this","forEach","callback","key","source","key2","get","id","ids","undefined","remove","i","set","value","prototype","pop","module","exports","JsonRpcClient","require","configuration","updateNotReconnectIfLessThan","Logger","debug","pingNextNum","notReconnectIfNumLessThan","sendPing","enabledPings","params","interval","heartbeat","PING_INTERVAL","self","send","pingNum","error","result","message","ws","reconnectWs","usePing","pingPongStarted","pingInterval","setInterval","wsConfig","status","DISCONNECTED","onreconnecting","onreconnected","onconnected","onerror","rpc","pull","request","reply","RECONNECTING","CONNECTED","WebSocketWithReconnection","uri","rpcBuilderOptions","request_timeout","requestTimeout","ping_request_timeout","heartbeatRequestTimeout","RpcBuilder","packers","JsonRPC","JSON","stringify","func","method","err","requestTime","Date","now","encode","data","e","close","clearInterval","sendCloseMessage","forceClose","millis","reconnect","console","config","logConnected","wsUri","reconnectToSameUri","maxRetries","numRetries","reconnecting","warn","forcingDisconnection","reconnectToNewUri","newWsUriOnReconnection","newWsUri","setTimeout","RETRY_TIME_MS","reconnectWsUri","newWs","useSockJS","SockJS","WebSocket","onopen","registerMessageHandler","onclose","reconnectionOnClose","onErrorOrClose","ondisconnect","closing","readyState","CLOSED","MAX_RETRIES","goodWsUri","addEventListener","type","BrowserWebSocket","global","MozWebSocket","window","CONNECTING","OPEN","CLOSING","unifyResponseMethods","responseMethods","response","unifyTransport","transport","Function","postMessage","write","onmessage","pause","SyntaxError","RpcNotification","defineProperty_IE8","Object","defineProperty","enumerable","packer","options","onRequest","transportMessage","event","decode","storeResponse","dest","timeout","responses","response_timeout","storeProcessedResponse","ack","from","processedResponses","duplicates_timeout","RpcRequest","call","getTransport","setTransport","bind","duplicated","Boolean","responseMethod","pack","clearTimeout","peerID","cancel","message2Key","requests","unpack","EventEmitter","on","max_retries","removeEventListener","removeListener","addListener","BASE_TIMEOUT","requestID","inherits","dispatchCallback","sendRequest","rt","Math","pow","retried","encode_transport","retry","Error","processRequest","idAck","emit","processResponse","duplicatedResponse","TypeError","notification","processed","oThis","aArgs","Array","slice","arguments","fToBind","fNOP","fBound","apply","concat","clients","transports","jsonrpc","String","parse","version","result_defined","error_defined","XmlRPC","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","er","handler","len","args","listeners","length","context","listener","m","newListener","push","warned","trace","once","g","fired","list","position","splice","removeAllListeners","listenerCount","evlistener","emitter","create","ctor","superCtor","super_","constructor","writable","configurable","TempCtor"],"mappings":"AAAA;ACAA,QAASA,UAEP,GAAIC,KAGJC,MAAKC,QAAU,SAASC,GAEtB,IAAI,GAAIC,KAAOJ,GACf,CACE,GAAIK,GAASL,EAAQI,EAErB,KAAI,GAAIE,KAAQD,GACdF,EAASE,EAAOC,MAItBL,KAAKM,IAAM,SAASC,EAAIH,GAEtB,GAAII,GAAMT,EAAQK,EAClB,QAAUK,IAAPD,EAGH,MAAOA,GAAID,IAGbP,KAAKU,OAAS,SAASH,EAAIH,GAEzB,GAAII,GAAMT,EAAQK,EAClB,QAAUK,IAAPD,EAAH,OAGOA,GAAID,EAGX,KAAI,GAAII,KAAKH,GAAK,OAAO,QAElBT,GAAQK,KAGjBJ,KAAKY,IAAM,SAASC,EAAON,EAAIH,GAE7B,OAAYK,IAATI,EACD,MAAOb,MAAKU,OAAOH,EAAIH,EAEzB,IAAII,GAAMT,EAAQK,OACRK,IAAPD,IACDT,EAAQK,GAAUI,MAEpBA,EAAID,GAAMM,GAKdf,OAAOgB,UAAUC,IAAM,SAASR,EAAIH,GAElC,GAAIS,GAAQb,KAAKM,IAAIC,EAAIH,EACzB,QAAYK,IAATI,EAKH,MAFAb,MAAKU,OAAOH,EAAIH,GAETS,GAITG,OAAOC,QAAUnB;;AChDjB,GAAIoB,eAAiBC,QAAQ,kBAG7BF,SAAQC,cAAiBA;;ACiCzB,QAASA,eAAcE,GAwInB,QAASC,KACLC,OAAOC,MAAM,+BAAiCC,EAAc,SACxDC,EAA4B,KAChCA,EAA4BD,EAGhC,QAASE,KACL,GAAIC,EAAc,CACd,GAAIC,GAAS,IACM,IAAfJ,GAAoBA,GAAeC,IACnCG,GACIC,SAAUT,EAAcU,WAAaC,gBAG7CP,IAEAQ,EAAKC,KAAK,OAAQL,EAAQ,SAAUM,GAChC,MAAO,UAASC,EAAOC,GACfD,IACAb,OAAOC,MAAM,0BAA4BW,EAAU,KAC/CC,EAAME,QAAU,KAChBH,EAAUT,IACVE,GAAe,EACfN,IACAC,OAAOC,MAAM,2CACTW,EAAU,sBACdI,EAAGC,kBAIhBf,QAEHF,QAAOC,MAAM,gDAQrB,QAASiB,KACAC,IACDnB,OAAOC,MAAM,iCACbkB,GAAkB,MAEahC,IAA3BW,EAAcU,YACdY,EAAeC,YAAYjB,EAAUN,EAAcU,WACnDJ,MArLZ,GASIgB,GATAV,EAAOhC,KAEP4C,EAAWxB,EAAckB,GAEzBb,GAA6B,EAE7BD,EAAc,EACdG,GAAe,EACfc,GAAkB,EAGlBI,EAASC,aAETC,EAAiBH,EAASG,eAC1BC,EAAgBJ,EAASI,cACzBC,EAAcL,EAASK,YACvBC,EAAUN,EAASM,OAEvB9B,GAAc+B,IAAIC,KAAO,SAASxB,EAAQyB,GACtCA,EAAQC,MAAM,KAAM,SAGxBV,EAASG,eAAiB,WAEtB,GADAzB,OAAOC,MAAM,wCACTsB,IAAWU,aAEX,WADAjC,QAAOa,MAAM,mGAIjBU,GAASU,aACLR,GACAA,KAIRH,EAASI,cAAgB,WAErB,GADA1B,OAAOC,MAAM,uCACTsB,IAAWW,UAEX,WADAlC,QAAOa,MAAM,+FAGjBU,GAASW,UAET7B,GAAe,EACfN,IACAmB,IAEIQ,GACAA,KAIRJ,EAASK,YAAc,WAEnB,GADA3B,OAAOC,MAAM,qCACTsB,IAAWW,UAEX,WADAlC,QAAOa,MAAM,6FAGjBU,GAASW,UAET7B,GAAe,EACfa,IAEIS,GACAA,KAIRL,EAASM,QAAU,SAASf,GACxBb,OAAOC,MAAM,iCAEbsB,EAASC,aAELI,GACAA,EAAQf,GAIhB,IAAIG,GAAK,GAAImB,2BAA0Bb,EAEvCtB,QAAOC,MAAM,gCAAkCqB,EAASc,IAExD,IAAIC,IACAC,gBAAiBxC,EAAc+B,IAAIU,eACnCC,qBAAsB1C,EAAc+B,IAAIY,yBAGxCZ,EAAM,GAAIa,YAAWA,WAAWC,QAAQC,QAASP,EAAmBrB,EACpE,SAASe,GAEL/B,OAAOC,MAAM,qBAAuB4C,KAAKC,UAAUf,GAEnD,KACI,GAAIgB,GAAOjD,EAAc+B,IAAIE,EAAQiB,YAExB7D,KAAT4D,EACA/C,OAAOa,MAAM,UAAYkB,EAAQiB,OAAS,6BAE1CD,EAAKhB,EAAQzB,OAAQyB,GAE3B,MAAOkB,GACLjD,OAAOa,MAAM,iCAAmCgC,KAAKC,UAAUf,IAC/D/B,OAAOa,MAAMoC,KAIzBvE,MAAKiC,KAAO,SAASqC,EAAQ1C,EAAQ1B,GAClB,SAAXoE,GACAhD,OAAOC,MAAM,mBAAqB+C,EAAS,WAAaH,KAAKC,UAAUxC,GAG3E,IAAI4C,GAAcC,KAAKC,KAEvBvB,GAAIwB,OAAOL,EAAQ1C,EAAQ,SAASO,EAAOC,GACvC,GAAID,EAAO,CACP,IACIb,OAAOa,MAAM,SAAWA,EAAME,QAAU,uBACpCiC,EAAS,WAAaH,KAAKC,UAAUxC,GAAU,YAC/CO,EAAMkB,SACNlB,EAAMyC,MACNtD,OAAOa,MAAM,cAAgBgC,KAAKC,UAAUjC,EAAMyC,OAExD,MAAOC,IACT1C,EAAMqC,YAAcA,EAEpBtE,QACcO,IAAV2B,GAAwC,SAAjBA,EAAOvB,OAC9BS,OAAOC,MAAM,aAAe4C,KAAKC,UAAUhC,IAE/ClC,EAASiC,EAAOC,OAyD5BpC,KAAK8E,MAAQ,WACTxD,OAAOC,MAAM,kDAEOd,IAAhBiC,IACApB,OAAOC,MAAM,0BACbwD,cAAcrC,IAElBD,GAAkB,EAClBd,GAAe,EAEXP,EAAc4D,kBACd1D,OAAOC,MAAM,yBACbvB,KAAKiC,KAAK,eAAgB,KAAM,SAASE,EAAOC,GACxCD,GACAb,OAAOa,MAAM,gCAAkCgC,KAAKC,UAAUjC,IAElEG,EAAGwC,WAGhBxC,EAAGwC,SAKF9E,KAAKiF,WAAa,SAASC,GACvB5C,EAAG2C,WAAWC,IAGlBlF,KAAKmF,UAAY,WACb7C,EAAGC,eA7PX,GAAIyB,YAAa7C,QAAQ,SACrBsC,0BAA4BtC,QAAQ,yCAExCsD,MAAKC,IAAMD,KAAKC,KAAO,WACnB,OAAQ,GAAID,MAGhB,IAAI1C,eAAgB,IAEhBwB,aAAe,eACfC,UAAY,YACZV,aAAe,eAEfxB,OAAS8D,OAqPbpE,QAAOC,QAAUC;;AClQjB,GAAIuC,2BAA6BtC,QAAQ,8BAGzCF,SAAQwC,0BAA6BA;;;ACJrC,YAuCA,SAASA,2BAA0B4B,GAgC/B,QAASC,GAAahD,EAAIiD,GACtB,IACIjE,OAAOC,MAAM,0BAA4BgE,GAC3C,MAAOV,GACLvD,OAAOa,MAAM0C,IAmBrB,QAASW,GAAmBC,EAAYC,GAGpC,GAFApE,OAAOC,MAAM,gCAAkCmE,EAAa,SAAWD,EAAa,KAEjE,IAAfC,EAAkB,CAClB,GAAIC,EAEA,WADArE,QAAOsE,KAAK,+EAGZD,IAAe,EAGfN,EAAOtC,gBACPsC,EAAOtC,iBAIX8C,EACAC,EAAkBL,EAAYC,EAAYH,GAGtCF,EAAOU,uBACPV,EAAOU,uBAAuB,SAAS5D,EAAO6D,GAEtC7D,GACAb,OAAOC,MAAMY,GACb8D,WAAW,WACPT,EAAmBC,EAAYC,EAAa,IAC7CQ,gBAEHJ,EAAkBL,EAAYC,EAAYM,KAIlDF,EAAkBL,EAAYC,EAAYH,GAMtD,QAASO,GAAkBL,EAAYC,EAAYS,GAC/C7E,OAAOC,MAAM,yBAA2BmE,GAExCpD,EAAGwC,QAEHS,EAAQY,GAAkBZ,CAE1B,IAAIa,EAEAA,GADAC,EACQ,GAAIC,QAAOf,GAEX,GAAIgB,WAAUhB,GAG1Ba,EAAMI,OAAS,WACXlF,OAAOC,MAAM,qBAAuBmE,EAAa,gBACjDJ,EAAac,EAAOb,GACpBI,GAAe,EACfc,IACIpB,EAAOrC,iBACPqC,EAAOrC,gBAGXoD,EAAMM,QAAUC,EAGpB,IAAIC,GAAiB,SAASzE,GAC1Bb,OAAOsE,KAAK,uBAAwBzD,GAEhCuD,IAAeD,EACXJ,EAAOwB,cACPxB,EAAOwB,eAGXZ,WAAW,WACPT,EAAmBC,EAAYC,EAAa,IAC7CQ,eAIXE,GAAMlD,QAAU0D,EAEhBtE,EAAK8D,EAtIT,GACIK,GAOAnE,EARAwE,GAAU,EAEVvB,EAAQF,EAAO3B,IACf2C,EAAYhB,EAAOgB,UACnBV,GAAe,EAEfE,GAAuB,CAKvBvD,GADA+D,EACK,GAAIC,QAAOf,GAEX,GAAIgB,WAAUhB,GAGvBjD,EAAGkE,OAAS,WACRlB,EAAahD,EAAIiD,GACbF,EAAOpC,aACPoC,EAAOpC,eAIfX,EAAGY,QAAU,SAASf,GAClBb,OAAOa,MAAM,wBAA0BoD,EAAQ,iCAAkCpD,GAC7EkD,EAAOnC,SACPmC,EAAOnC,QAAQf,GAYvB,IAAIwE,GAAsB,WAClBrE,EAAGyE,aAAeC,OACdF,EACAxF,OAAOC,MAAM,8BAEbD,OAAOC,MAAM,mDACbiE,EAAmByB,YAAa,IAGpC3F,OAAOC,MAAM,uDAIrBe,GAAGoE,QAAUC,EAsFb3G,KAAK8E,MAAQ,WACTgC,GAAU,EACVxE,EAAGwC,SAKP9E,KAAKiF,WAAa,SAASC,GAGvB,GAFA5D,OAAOC,MAAM,kCAET2D,EAAQ,CACR5D,OAAOC,MAAM,6BAA+B2D,EAAS,kCACrD,IAAIgC,GAAY3B,CAChBA,GAAQ,4BAERM,GAAuB,EAEvBI,WAAW,WACP3E,OAAOC,MAAM,+BAAiC2F,GAC9C3B,EAAQ2B,EAERrB,GAAuB,GAExBX,GAGP5C,EAAGwC,SAGP9E,KAAKuC,YAAc,WACfjB,OAAOC,MAAM,eACbiE,EAAmByB,YAAa,EAAG1B,IAGvCvF,KAAKiC,KAAO,SAASI,GACjBC,EAAGL,KAAKI,IAGZrC,KAAKmH,iBAAmB,SAASC,EAAMlH,IACnCuG,EAAyB,WACrBnE,EAAG6E,iBAAiBC,EAAMlH,QAxNtC,GAAImH,kBAAmBC,OAAOf,WAAae,OAAOC,aAE9CjG,OAAS8D,QAQTmB,UAAYc,gBAChB,KAAKd,WAA+B,mBAAXiB,QACrB,IACIjB,UAAYpF,QAAQ,MACtB,MAAO0D,IAKb,GAAIoC,aAAc,IACdf,cAAgB,IAEhBuB,WAAa,EACbC,KAAO,EACPC,QAAU,EACVX,OAAS,CAsMbhG,QAAOC,QAAUwC;;;;AC5KjB,QAASmE,sBAAqBC,GAE5B,IAAIA,EAAiB,QAErB,KAAI,GAAI1H,KAAO0H,GACf,CACE,GAAIhH,GAAQgH,EAAgB1H,EAET,iBAATU,KACRgH,EAAgB1H,IAEd2H,SAAUjH,IAIhB,MAAOgH,GAGT,QAASE,gBAAeC,GAEtB,GAAIA,EAAJ,CAGA,GAAGA,YAAqBC,UACtB,OAAQhG,KAAM+F,EAGhB,IAAGA,EAAU/F,eAAgBgG,UAC3B,MAAOD,EAGT,IAAGA,EAAUE,sBAAuBD,UAGlC,MADAD,GAAU/F,KAAO+F,EAAUE,YACpBF,CAIT,IAAGA,EAAUG,gBAAiBF,UAG5B,MADAD,GAAU/F,KAAO+F,EAAUG,MACpBH,CAIT,QAA2BvH,KAAxBuH,EAAUI,aACVJ,EAAUK,gBAAiBJ,WAE9B,KAAM,IAAIK,aAAY,mDAcxB,QAASC,iBAAgBjE,EAAQ1C,GAE5B4G,oBAEDxI,KAAKsE,OAASA,EACdtE,KAAK4B,OAASA,IAId6G,OAAOC,eAAe1I,KAAM,UAAWa,MAAOyD,EAAQqE,YAAY,IAClEF,OAAOC,eAAe1I,KAAM,UAAWa,MAAOe,EAAQ+G,YAAY,KAkBtE,QAAS3E,YAAW4E,EAAQC,EAASb,EAAWc,GA+D9C,QAASC,GAAiBC,GAExBhH,EAAKiH,OAAOD,EAAMpE,MAAQoE,GAgE5B,QAASE,GAAc7G,EAAS9B,EAAI4I,GAElC,GAAIrB,IAEFzF,QAASA,EAET+G,QAASnD,WAAW,WAElBoD,EAAU3I,OAAOH,EAAI4I,IAEvBG,GAGFD,GAAUzI,IAAIkH,EAAUvH,EAAI4I,GAM9B,QAASI,GAAuBC,EAAKC,GAEnC,GAAIL,GAAUnD,WAAW,WAEvByD,EAAmBhJ,OAAO8I,EAAKC,IAEjCE,EAEAD,GAAmB9I,IAAIwI,EAASI,EAAKC,GAiBvC,QAASG,GAAWtF,EAAQ1C,EAAQrB,EAAIkJ,EAAMzB,GAE5CO,gBAAgBsB,KAAK7J,KAAMsE,EAAQ1C,GAEnC5B,KAAK8J,aAAe,WAElB,MAAO9B,IAEThI,KAAK+J,aAAe,SAASlJ,GAE3BmH,EAAYD,eAAelH,IAGzB2H,oBACFC,OAAOC,eAAe1I,KAAM,aAE1BM,IAAKN,KAAK8J,aAAaE,KAAKhK,MAC5BY,IAAKZ,KAAK+J,aAAaC,KAAKhK,OAGhC,IAAI8H,GAAWuB,EAAU/I,IAAIC,EAAIkJ,EAK5BzB,IAAahG,EAAK8H,iBAElBtB,mBACDxI,KAAKiK,WAAaC,QAAQpC,GAE1BW,OAAOC,eAAe1I,KAAM,cAE1Ba,MAAOqJ,QAAQpC,KAIrB,IAAIqC,GAAiBtC,EAAgBvD,EAErCtE,MAAKoK,KAAOxB,EAAOwB,KAAKJ,KAAKpB,EAAQ5I,KAAMO,GAU3CP,KAAKsD,MAAQ,SAASnB,EAAOC,EAAQ4F,GAGnC,GAAG7F,YAAiB8F,WAAY9F,GAASA,EAAMF,eAAgBgG,UAC/D,CACE,OAAaxH,IAAV2B,EACD,KAAM,IAAIkG,aAAY,2CAExBN,GAAY7F,EACZC,EAAS,KACTD,MAAQ1B,OAGL,IAAG2B,YAAkB6F,WACvB7F,GAAUA,EAAOH,eAAgBgG,UACpC,CACE,OAAgBxH,IAAbuH,EACD,KAAM,IAAIM,aAAY,2CAExBN,GAAY5F,EACZA,EAAS,KAGX4F,EAAYD,eAAeC,GAGxBF,GACDuC,aAAavC,EAASsB,aAEb3I,IAARgJ,IAEEtH,IACDA,EAAMgH,KAAOM,GAEZrH,IACDA,EAAO+G,KAAOM,GAGlB,IAAIpH,EAGJ,IAAGF,OAAmB1B,IAAV2B,EACZ,CAUE,OATkB3B,IAAfuB,EAAKsI,SAEHnI,EACDA,EAAMsH,KAAOzH,EAAKsI,OAElBlI,EAAOqH,KAAOzH,EAAKsI,QAIpBH,EAED,OAA2B1J,IAAxB0J,EAAehI,OAAsBA,EACtCE,GAEEF,MAAOA,OAIX,CACE,GAAImC,GAASnC,EACAgI,EAAehI,MACfgI,EAAerC,QAE5BzF,IAEEiC,OAAQA,EACR1C,OAAQO,GAASC,OAKrBC,IAEEF,MAAQA,EACRC,OAAQA,EAGZC,GAAUuG,EAAOwB,KAAK/H,EAAS9B,OAK/B8B,GADMyF,EACIA,EAASzF,QAITuG,EAAOwB,MAAMhI,OAAQ,MAAO7B,EAQxC,OALA2I,GAAc7G,EAAS9B,EAAIkJ,GAG3BzB,EAAYA,GAAahI,KAAK8J,gBAAkB9H,EAAK8H,eAElD9B,EACMA,EAAU/F,KAAKI,GAEjBA,GAMX,QAASkI,GAAOlI,GAEd,GAAIlC,GAAMqK,EAAYnI,EACtB,IAAIlC,EAAJ,OAEOqK,GAAYnI,EAEnB,IAAIgB,GAAUoH,EAAS1J,IAAIZ,EAAII,GAAIJ,EAAIgJ,KACnC9F,KAEJgH,aAAahH,EAAQ+F,SAGrBG,EAAuBpJ,EAAII,GAAIJ,EAAIgJ,QAlVrC,GAAInH,GAAOhC,IAEX,KAAI4I,EACF,KAAM,IAAIN,aAAY,wBAExB,KAAIM,EAAOwB,OAASxB,EAAO8B,OACzB,KAAM,IAAIpC,aAAY,oBAExB,IAAIT,GAAkBD,qBAAqBgB,EAAOf,gBAGlD,IAAGgB,YAAmBZ,UACtB,CACE,OAAgBxH,IAAbuH,EACD,KAAM,IAAIM,aAAY,4CAExBQ,GAAYD,EACZb,MAAYvH,GACZoI,MAAYpI,GAGd,GAAGoI,GAAWA,EAAQ5G,eAAgBgG,UACtC,CACE,GAAGD,KAAeA,YAAqBC,WACrC,KAAM,IAAIK,aAAY,yCAExBQ,GAAYd,EACZA,EAAYa,EACZA,MAAYpI,GAGd,GAAGuH,YAAqBC,UACxB,CACE,OAAgBxH,IAAbqI,EACD,KAAM,IAAIR,aAAY,4CAExBQ,GAAYd,EACZA,MAAYvH,GAGd,GAAGuH,GAAaA,EAAU/F,eAAgBgG,WACrCa,KAAeA,YAAqBb,WACrC,KAAM,IAAIK,aAAY,yCAE1BO,GAAUA,MAGV8B,aAAad,KAAK7J,MAEf8I,GACD9I,KAAK4K,GAAG,UAAW9B,GAGlBN,mBACDxI,KAAKsK,OAASzB,EAAQyB,OAEtB7B,OAAOC,eAAe1I,KAAM,UAAWa,MAAOgI,EAAQyB,QAExD,IAAIO,GAAchC,EAAQgC,aAAe,CAQzC7K,MAAK8J,aAAe,WAElB,MAAO9B,IAEThI,KAAK+J,aAAe,SAASlJ,GAGxBmH,IAGEA,EAAU8C,oBACX9C,EAAU8C,oBAAoB,UAAW/B,GAGnCf,EAAU+C,gBAChB/C,EAAU+C,eAAe,OAAQhC,IAIlClI,IAGEA,EAAMsG,iBACPtG,EAAMsG,iBAAiB,UAAW4B,GAG5BlI,EAAMmK,aACZnK,EAAMmK,YAAY,OAAQjC,IAG9Bf,EAAYD,eAAelH,IAGzB2H,oBACFC,OAAOC,eAAe1I,KAAM,aAE1BM,IAAKN,KAAK8J,aAAaE,KAAKhK,MAC5BY,IAAKZ,KAAK+J,aAAaC,KAAKhK,QAGhCA,KAAK+J,aAAa/B,EAGlB,IAAIpE,GAAuBiF,EAAQjF,iBAAwBqH,aACvDnH,EAAuB+E,EAAQ/E,sBAAwBF,EACvD0F,EAAuBT,EAAQS,kBAAwB2B,aACvDtB,EAAuBd,EAAQc,oBAAwBsB,aAGvDC,EAAY,EAEZT,EAAY,GAAI3K,QAChBuJ,EAAY,GAAIvJ,QAChB4J,EAAqB,GAAI5J,QAEzB0K,IAyMJW,UAASvB,EAAYrB,iBAwBrBvI,KAAKuK,OAAS,SAASlI,GAErB,GAAGA,EAAS,MAAOkI,GAAOlI,EAE1B,KAAI,GAAIA,KAAWmI,GACjBD,EAAOlI,IAIXrC,KAAK8E,MAAQ,WAGX,GAAIkD,GAAYhI,KAAK8J,cAClB9B,IAAaA,EAAUlD,OACvBkD,EAAUlD,QAGb9E,KAAKuK,SAELb,EAAmBzJ,QAAQoK,cAG3BhB,EAAUpJ,QAAQ,SAAS6H,GAEzBuC,aAAavC,EAASsB,YAiB1BpJ,KAAK2E,OAAS,SAASL,EAAQ1C,EAAQuH,EAAMnB,EAAW9H,GA6DpD,QAASkL,GAAiBjJ,EAAOC,GAE/BJ,EAAKuI,OAAOlI,GAEZnC,EAASiC,EAAOC,GAYlB,QAASiJ,GAAYrD,GAEnB,GAAIsD,GAAiB,SAAXhH,EAAoBR,EAAuBF,CAMrD,OALAP,GAAQ+F,QAAUnD,WAAWmD,EAASkC,EAAGC,KAAKC,IAAI,EAAGC,MACrDjB,EAAYnI,IAAY9B,GAAIA,EAAI4I,KAAMA,GACtCsB,EAAS7J,IAAIyC,EAAS9C,EAAI4I,GAE1BnB,EAAYA,GAAa0D,GAAoB1J,EAAK8H,eAC/C9B,EACMA,EAAU/F,KAAKI,GAEjBA,EAGT,QAASsJ,GAAM3D,GAEbA,EAAYD,eAAeC,GAE3B5C,QAAQQ,KAAK6F,EAAQ,8BAA8BpJ,EAEnD,IAAI+G,GAAUM,EAAmB3I,IAAIR,EAAI4I,EAGzC,OAFAkB,cAAajB,GAENiC,EAAYrD,GAGrB,QAASoB,KAEP,GAAGqC,EAAUZ,EACX,MAAOc,GAAM3D,EAEf,IAAI7F,GAAQ,GAAIyJ,OAAM,wBAClBzJ,GAAMkB,QAAUhB,EAEpBF,EAAMwJ,MAAQA,EAEdP,EAAiBjJ,GA9GrB,GAAGP,YAAkBqG,UACrB,CACE,OAAWxH,IAAR0I,EACD,KAAM,IAAIb,aAAY,2CAExBpI,GAAY0B,EACZoG,MAAYvH,GACZ0I,MAAY1I,GACZmB,MAAYnB,OAGT,IAAG0I,YAAgBlB,UACxB,CACE,OAAgBxH,IAAbuH,EACD,KAAM,IAAIM,aAAY,2CAExBpI,GAAYiJ,EACZnB,MAAYvH,GACZ0I,MAAY1I,OAGT,IAAGuH,YAAqBC,UAC7B,CACE,OAAexH,IAAZP,EACD,KAAM,IAAIoI,aAAY,2CAExBpI,GAAY8H,EACZA,MAAYvH,OAGIA,IAAfuB,EAAKsI,SAEN1I,EAASA,MAETA,EAAO6H,KAAOzH,EAAKsI,YAGV7J,IAAR0I,IAEDvH,EAASA,MAETA,EAAOuH,KAAOA,EAIhB,IAAI9G,IAEFiC,OAAQA,EACR1C,OAAQA,EAGV,IAAG1B,EACH,CACE,GAAIK,GAAK2K,IACLO,EAAU,CAEdpJ,GAAUuG,EAAOwB,KAAK/H,EAAS9B,EAS/B,IAAI8C,IAEFhB,QAAiBA,EACjBnC,SAAiBkL,EACjBvD,gBAAiBA,EAAgBvD,QAG/BoH,EAAmB3D,eAAeC,EAyCtC,OAAOqD,GAAYrD,GAOrB,MAHA3F,GAAUuG,EAAOwB,KAAK/H,GAEtB2F,EAAYA,GAAahI,KAAK8J,eAC3B9B,EACMA,EAAU/F,KAAKI,GAEjBA,GAcTrC,KAAKiJ,OAAS,SAAS5G,EAAS2F,GAoC9B,QAAS6D,KAIP,GADA7D,EAAYD,eAAeC,IAAchG,EAAK8H,eAE9C,CACE,GAAIhC,GAAWuB,EAAU/I,IAAIC,EAAIkJ,EACjC,IAAG3B,EACD,MAAOE,GAAU/F,KAAK6F,EAASzF,SAGnC,GAAIyJ,OAAerL,IAANF,EAAmBA,EAAKiJ,EACjCnG,EAAU,GAAIuG,GAAWtF,EAAQ1C,EAAQkK,EAAOrC,EAAMzB,EAE1D,KAAGhG,EAAK+J,KAAK,UAAW1I,GACxB,MAAOA,GAGT,QAAS2I,GAAgB3I,EAASlB,EAAOC,GAEvCiB,EAAQnD,SAASiC,EAAOC,GAG1B,QAAS6J,GAAmB7C,GAE1BhE,QAAQQ,KAAK,6BAA8BvD,GAG3CgI,aAAajB,GACbG,EAAuBC,EAAKC,GA/D9B,IAAIpH,EACF,KAAM,IAAI6J,WAAU,yBAEtB,KAEE7J,EAAUuG,EAAO8B,OAAOrI,GAE1B,MAAMwC,GAGJ,MAAOO,SAAQ7D,MAAMsD,EAAGxC,GAG1B,GAAI9B,GAAS8B,EAAQ9B,GACjBiJ,EAASnH,EAAQmH,IACjBlF,EAASjC,EAAQiC,OACjB1C,EAASS,EAAQT,WAEjB6H,EAAO7H,EAAO6H,KACdN,EAAOvH,EAAOuH,IAGlB,QAAkB1I,IAAfuB,EAAKsI,QAAuBb,GAAQzH,EAAKsI,OAA5C,CAGA,OAAS7J,IAANF,OAA0BE,IAAP+I,EACtB,CACE,GAAI2C,GAAe,GAAI5D,iBAAgBjE,EAAQ1C,EAE/C,IAAGI,EAAK+J,KAAK,UAAWI,GAAe,MACvC,OAAOA,GAsCT,GAAG7H,EACH,CAEE,OAAW7D,IAAR0I,GAAqBA,GAAQnH,EAAKsI,OACrC,CACE,GAAIjH,GAAUoH,EAASnK,IAAIkJ,EAAKC,EAChC,IAAGpG,EACH,CACE,GAAIwE,GAAkBxE,EAAQwE,eAE9B,OAAGvD,IAAUuD,EAAgB1F,MACpB6J,EAAgB3I,EAASzB,GAE/B0C,GAAUuD,EAAgBC,SACpBkE,EAAgB3I,EAAS,KAAMzB,GAEjCiK,IAGT,GAAIO,GAAY1C,EAAmBpJ,IAAIkJ,EAAKC,EAC5C,IAAG2C,EACD,MAAOH,GAAmBG,GAI9B,MAAOP,KAGT,GAAI1J,GAASE,EAAQF,MACjBC,EAASC,EAAQD,MAGrB,MAAGD,GAAUA,EAAMgH,MAAShH,EAAMgH,MAASnH,EAAKsI,QAC7ClI,GAAUA,EAAO+G,MAAQ/G,EAAO+G,MAAQnH,EAAKsI,QAAhD,CAGA,GAAIjH,GAAUoH,EAASnK,IAAIkJ,EAAKC,EAChC,KAAIpG,EACJ,CACE,GAAI+I,GAAY1C,EAAmBpJ,IAAIkJ,EAAKC,EAC5C,OAAG2C,GACMH,EAAmBG,GAErBhH,QAAQQ,KAAK,2CAA4CvD,GAIlE2J,EAAgB3I,EAASlB,EAAOC,MAnxBpC,GAAIoG,qBAAqB,CACzB,IAAGC,OAAOC,eAER,IAEED,OAAOC,kBAAmB,QAE5B,MAAM7D,GAEJ2D,oBAAqB,EAKpBP,SAASnH,UAAUkJ,OACtB/B,SAASnH,UAAUkJ,KAAO,SAASqC,GACjC,GAAoB,kBAATrM,MAGT,KAAM,IAAIkM,WAAU,uEAGtB,IAAII,GAAUC,MAAMzL,UAAU0L,MAAM3C,KAAK4C,UAAW,GAChDC,EAAU1M,KACV2M,EAAU,aACVC,EAAU,WACR,MAAOF,GAAQG,MAAM7M,eAAgB2M,IAAQN,EACpCrM,KACAqM,EACFC,EAAMQ,OAAOP,MAAMzL,UAAU0L,MAAM3C,KAAK4C,aAMrD,OAHAE,GAAK7L,UAAYd,KAAKc,UACtB8L,EAAO9L,UAAY,GAAI6L,GAEhBC,GAKX,IAAIjC,cAAexJ,QAAQ,UAAUwJ,aAEjCQ,SAAWhK,QAAQ,YAEnB8C,QAAU9C,QAAQ,aAClBrB,OAASqB,QAAQ,YAGjB8J,aAAe,GAsuBnBE,UAASnH,WAAY2G,cAGrB3G,WAAWuE,gBAAkBA,gBAG7BvH,OAAOC,QAAU+C,UAEjB,IAAI+I,SAAU5L,QAAQ,aAClB6L,WAAa7L,QAAQ,uBAEzB6C,YAAW+I,QAAUA,QACrB/I,WAAW+I,QAAQC,WAAaA,WAChChJ,WAAWC,QAAUA;;ACzyBrB,QAASmG,MAAK/H,EAAS9B,GAErB,GAAI6B,IAEF6K,QAAS,MAIX,IAAG5K,EAAQiC,OAETlC,EAAOkC,OAASjC,EAAQiC,OAErBjC,EAAQT,SACTQ,EAAOR,OAASS,EAAQT,YAGjBnB,IAANF,IACD6B,EAAO7B,GAAKA,OAIX,QAASE,IAANF,EACR,CACE,GAAG8B,EAAQF,MACX,CACE,OAAsB1B,KAAnB4B,EAAQD,OACT,KAAM,IAAI8J,WAAU,oCAEtB9J,GAAOD,MAAQE,EAAQF,UAEpB,CAAA,OAAsB1B,KAAnB4B,EAAQD,OAGd,KAAM,IAAI8J,WAAU,gCAFpB9J,GAAOA,OAASC,EAAQD,OAI1BA,EAAO7B,GAAKA,EAGd,MAAO4D,MAAKC,UAAUhC,GAYxB,QAASsI,QAAOrI,GAEd,GAAID,GAASC,GAES,gBAAZA,IAAwBA,YAAmB6K,WACnD9K,EAAS+B,KAAKgJ,MAAM9K,GAKtB,IAAI+K,GAAUhL,EAAO6K,OACrB,IAAe,QAAZG,EACD,KAAM,IAAIlB,WAAU,4BAA8BkB,EAAU,MAAQ/K,EAGtE,QAAoB5B,IAAjB2B,EAAOkC,OACV,CACE,OAAgB7D,IAAb2B,EAAO7B,GACR,KAAM,IAAI2L,WAAU,oBAAoB7J,EAE1C,IAAIgL,OAAmC5M,KAAlB2B,EAAOA,OACxBkL,MAAmC7M,KAAlB2B,EAAOD,KAG5B,IAAGkL,GAAkBC,EACnB,KAAM,IAAIpB,WAAU,sCAAsC7J,EAE5D,KAAIgL,IAAmBC,EACrB,KAAM,IAAIpB,WAAU,kCAAkC7J,EAExDD,GAAOoH,IAAMpH,EAAO7B,SACb6B,GAAO7B,GAIhB,MAAO6B,GAITnB,QAAQmJ,KAASA,KACjBnJ,QAAQyJ,OAASA;;ACtGjB,QAASN,MAAK/H,GAEZ,KAAM,IAAI6J,WAAU,uBAGtB,QAASxB,QAAOrI,GAEd,KAAM,IAAI6J,WAAU,uBAItBjL,QAAQmJ,KAASA,KACjBnJ,QAAQyJ,OAASA;;ACZjB,GAAIxG,SAAU/C,QAAQ,aAClBoM,OAAUpM,QAAQ,WAGtBF,SAAQiD,QAAUA,QAClBjD,QAAQsM,OAAUA;;ACgBlB,QAAS5C,gBACP3K,KAAKwN,QAAUxN,KAAKwN,YACpBxN,KAAKyN,cAAgBzN,KAAKyN,mBAAiBhN,GAwQ7C,QAASiN,YAAWC,GAClB,MAAsB,kBAARA,GAGhB,QAASC,UAASD,GAChB,MAAsB,gBAARA,GAGhB,QAASE,UAASF,GAChB,MAAsB,gBAARA,IAA4B,OAARA,EAGpC,QAASG,aAAYH,GACnB,WAAe,KAARA,EAnRT3M,OAAOC,QAAU0J,aAGjBA,aAAaA,aAAeA,aAE5BA,aAAa7J,UAAU0M,YAAU/M,GACjCkK,aAAa7J,UAAU2M,kBAAgBhN,GAIvCkK,aAAaoD,oBAAsB,GAInCpD,aAAa7J,UAAUkN,gBAAkB,SAASC,GAChD,IAAKL,SAASK,IAAMA,EAAI,GAAKC,MAAMD,GACjC,KAAM/B,WAAU,8BAElB,OADAlM,MAAKyN,cAAgBQ,EACdjO,MAGT2K,aAAa7J,UAAUiL,KAAO,SAAS3E,GACrC,GAAI+G,GAAIC,EAASC,EAAKC,EAAM3N,EAAG4N,CAM/B,IAJKvO,KAAKwN,UACRxN,KAAKwN,YAGM,UAATpG,KACGpH,KAAKwN,QAAQrL,OACb0L,SAAS7N,KAAKwN,QAAQrL,SAAWnC,KAAKwN,QAAQrL,MAAMqM,QAAS,CAEhE,IADAL,EAAK1B,UAAU,aACGb,OAChB,KAAMuC,EAGN,IAAI5J,GAAM,GAAIqH,OAAM,yCAA2CuC,EAAK,IAEpE,MADA5J,GAAIkK,QAAUN,EACR5J,EAOZ,GAFA6J,EAAUpO,KAAKwN,QAAQpG,GAEnB0G,YAAYM,GACd,OAAO,CAET,IAAIV,WAAWU,GACb,OAAQ3B,UAAU+B,QAEhB,IAAK,GACHJ,EAAQvE,KAAK7J,KACb,MACF,KAAK,GACHoO,EAAQvE,KAAK7J,KAAMyM,UAAU,GAC7B,MACF,KAAK,GACH2B,EAAQvE,KAAK7J,KAAMyM,UAAU,GAAIA,UAAU,GAC3C,MAEF,SACE6B,EAAO/B,MAAMzL,UAAU0L,MAAM3C,KAAK4C,UAAW,GAC7C2B,EAAQvB,MAAM7M,KAAMsO,OAEnB,IAAIT,SAASO,GAIlB,IAHAE,EAAO/B,MAAMzL,UAAU0L,MAAM3C,KAAK4C,UAAW,GAC7C8B,EAAYH,EAAQ5B,QACpB6B,EAAME,EAAUC,OACX7N,EAAI,EAAGA,EAAI0N,EAAK1N,IACnB4N,EAAU5N,GAAGkM,MAAM7M,KAAMsO,EAG7B,QAAO,GAGT3D,aAAa7J,UAAUkK,YAAc,SAAS5D,EAAMsH,GAClD,GAAIC,EAEJ,KAAKjB,WAAWgB,GACd,KAAMxC,WAAU,8BA2ClB,OAzCKlM,MAAKwN,UACRxN,KAAKwN,YAIHxN,KAAKwN,QAAQoB,aACf5O,KAAK+L,KAAK,cAAe3E,EACfsG,WAAWgB,EAASA,UACpBA,EAASA,SAAWA,GAE3B1O,KAAKwN,QAAQpG,GAGTyG,SAAS7N,KAAKwN,QAAQpG,IAE7BpH,KAAKwN,QAAQpG,GAAMyH,KAAKH,GAGxB1O,KAAKwN,QAAQpG,IAASpH,KAAKwN,QAAQpG,GAAOsH,GAN1C1O,KAAKwN,QAAQpG,GAAQsH,EASnBb,SAAS7N,KAAKwN,QAAQpG,MAAWpH,KAAKwN,QAAQpG,GAAM0H,SAIpDH,EAHGb,YAAY9N,KAAKyN,eAGhB9C,aAAaoD,oBAFb/N,KAAKyN,gBAKFkB,EAAI,GAAK3O,KAAKwN,QAAQpG,GAAMoH,OAASG,IAC5C3O,KAAKwN,QAAQpG,GAAM0H,QAAS,EAC5B1J,QAAQjD,MAAM,mIAGAnC,KAAKwN,QAAQpG,GAAMoH,QACJ,kBAAlBpJ,SAAQ2J,OAEjB3J,QAAQ2J,SAKP/O,MAGT2K,aAAa7J,UAAU8J,GAAKD,aAAa7J,UAAUkK,YAEnDL,aAAa7J,UAAUkO,KAAO,SAAS5H,EAAMsH,GAM3C,QAASO,KACPjP,KAAK+K,eAAe3D,EAAM6H,GAErBC,IACHA,GAAQ,EACRR,EAAS7B,MAAM7M,KAAMyM,YAVzB,IAAKiB,WAAWgB,GACd,KAAMxC,WAAU,8BAElB,IAAIgD,IAAQ,CAcZ,OAHAD,GAAEP,SAAWA,EACb1O,KAAK4K,GAAGxD,EAAM6H,GAEPjP,MAIT2K,aAAa7J,UAAUiK,eAAiB,SAAS3D,EAAMsH,GACrD,GAAIS,GAAMC,EAAUZ,EAAQ7N,CAE5B,KAAK+M,WAAWgB,GACd,KAAMxC,WAAU,8BAElB,KAAKlM,KAAKwN,UAAYxN,KAAKwN,QAAQpG,GACjC,MAAOpH,KAMT,IAJAmP,EAAOnP,KAAKwN,QAAQpG,GACpBoH,EAASW,EAAKX,OACdY,GAAY,EAERD,IAAST,GACRhB,WAAWyB,EAAKT,WAAaS,EAAKT,WAAaA,QAC3C1O,MAAKwN,QAAQpG,GAChBpH,KAAKwN,QAAQzC,gBACf/K,KAAK+L,KAAK,iBAAkB3E,EAAMsH,OAE/B,IAAIb,SAASsB,GAAO,CACzB,IAAKxO,EAAI6N,EAAQ7N,KAAM,GACrB,GAAIwO,EAAKxO,KAAO+N,GACXS,EAAKxO,GAAG+N,UAAYS,EAAKxO,GAAG+N,WAAaA,EAAW,CACvDU,EAAWzO,CACX,OAIJ,GAAIyO,EAAW,EACb,MAAOpP,KAEW,KAAhBmP,EAAKX,QACPW,EAAKX,OAAS,QACPxO,MAAKwN,QAAQpG,IAEpB+H,EAAKE,OAAOD,EAAU,GAGpBpP,KAAKwN,QAAQzC,gBACf/K,KAAK+L,KAAK,iBAAkB3E,EAAMsH,GAGtC,MAAO1O,OAGT2K,aAAa7J,UAAUwO,mBAAqB,SAASlI,GACnD,GAAIjH,GAAKoO,CAET,KAAKvO,KAAKwN,QACR,MAAOxN,KAGT,KAAKA,KAAKwN,QAAQzC,eAKhB,MAJyB,KAArB0B,UAAU+B,OACZxO,KAAKwN,WACExN,KAAKwN,QAAQpG,UACbpH,MAAKwN,QAAQpG,GACfpH,IAIT,IAAyB,IAArByM,UAAU+B,OAAc,CAC1B,IAAKrO,IAAOH,MAAKwN,QACH,mBAARrN,GACJH,KAAKsP,mBAAmBnP,EAI1B,OAFAH,MAAKsP,mBAAmB,kBACxBtP,KAAKwN,WACExN,KAKT,GAFAuO,EAAYvO,KAAKwN,QAAQpG,GAErBsG,WAAWa,GACbvO,KAAK+K,eAAe3D,EAAMmH,OACrB,IAAIA,EAET,KAAOA,EAAUC,QACfxO,KAAK+K,eAAe3D,EAAMmH,EAAUA,EAAUC,OAAS,GAI3D,cAFOxO,MAAKwN,QAAQpG,GAEbpH,MAGT2K,aAAa7J,UAAUyN,UAAY,SAASnH,GAQ1C,MANKpH,MAAKwN,SAAYxN,KAAKwN,QAAQpG,GAE1BsG,WAAW1N,KAAKwN,QAAQpG,KACxBpH,KAAKwN,QAAQpG,IAEdpH,KAAKwN,QAAQpG,GAAMoF,YAI7B7B,aAAa7J,UAAUyO,cAAgB,SAASnI,GAC9C,GAAIpH,KAAKwN,QAAS,CAChB,GAAIgC,GAAaxP,KAAKwN,QAAQpG,EAE9B,IAAIsG,WAAW8B,GACb,MAAO,EACJ,IAAIA,EACP,MAAOA,GAAWhB,OAEtB,MAAO,IAGT7D,aAAa4E,cAAgB,SAASE,EAASrI,GAC7C,MAAOqI,GAAQF,cAAcnI;;AC5RF,kBAAlBqB,QAAOiH,OAEhB1O,OAAOC,QAAU,SAAkB0O,EAAMC,GACvCD,EAAKE,OAASD,EACdD,EAAK7O,UAAY2H,OAAOiH,OAAOE,EAAU9O,WACvCgP,aACEjP,MAAO8O,EACPhH,YAAY,EACZoH,UAAU,EACVC,cAAc,MAMpBhP,OAAOC,QAAU,SAAkB0O,EAAMC,GACvCD,EAAKE,OAASD,CACd,IAAIK,GAAW,YACfA,GAASnP,UAAY8O,EAAU9O,UAC/B6O,EAAK7O,UAAY,GAAImP,GACrBN,EAAK7O,UAAUgP,YAAcH","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","function Mapper()\n{\n  var sources = {};\n\n\n  this.forEach = function(callback)\n  {\n    for(var key in sources)\n    {\n      var source = sources[key];\n\n      for(var key2 in source)\n        callback(source[key2]);\n    };\n  };\n\n  this.get = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return undefined;\n\n    return ids[id];\n  };\n\n  this.remove = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return;\n\n    delete ids[id];\n\n    // Check it's empty\n    for(var i in ids){return false}\n\n    delete sources[source];\n  };\n\n  this.set = function(value, id, source)\n  {\n    if(value == undefined)\n      return this.remove(id, source);\n\n    var ids = sources[source];\n    if(ids == undefined)\n      sources[source] = ids = {};\n\n    ids[id] = value;\n  };\n};\n\n\nMapper.prototype.pop = function(id, source)\n{\n  var value = this.get(id, source);\n  if(value == undefined)\n    return undefined;\n\n  this.remove(id, source);\n\n  return value;\n};\n\n\nmodule.exports = Mapper;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nvar JsonRpcClient  = require('./jsonrpcclient');\n\n\nexports.JsonRpcClient  = JsonRpcClient;","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nvar RpcBuilder = require('../..');\nvar WebSocketWithReconnection = require('./transports/webSocketWithReconnection');\n\nDate.now = Date.now || function() {\n    return +new Date;\n};\n\nvar PING_INTERVAL = 5000;\n\nvar RECONNECTING = 'RECONNECTING';\nvar CONNECTED = 'CONNECTED';\nvar DISCONNECTED = 'DISCONNECTED';\n\nvar Logger = console;\n\n/**\n *\n * heartbeat: interval in ms for each heartbeat message,\n * sendCloseMessage : true / false, before closing the connection, it sends a closeSession message\n * <pre>\n * ws : {\n * \turi : URI to conntect to,\n *  useSockJS : true (use SockJS) / false (use WebSocket) by default,\n * \tonconnected : callback method to invoke when connection is successful,\n * \tondisconnect : callback method to invoke when the connection is lost,\n * \tonreconnecting : callback method to invoke when the client is reconnecting,\n * \tonreconnected : callback method to invoke when the client succesfully reconnects,\n * \tonerror : callback method to invoke when there is an error\n * },\n * rpc : {\n * \trequestTimeout : timeout for a request,\n * \tsessionStatusChanged: callback method for changes in session status,\n * \tmediaRenegotiation: mediaRenegotiation\n * }\n * </pre>\n */\nfunction JsonRpcClient(configuration) {\n\n    var self = this;\n\n    var wsConfig = configuration.ws;\n\n    var notReconnectIfNumLessThan = -1;\n\n    var pingNextNum = 0;\n    var enabledPings = true;\n    var pingPongStarted = false;\n    var pingInterval;\n\n    var status = DISCONNECTED;\n\n    var onreconnecting = wsConfig.onreconnecting;\n    var onreconnected = wsConfig.onreconnected;\n    var onconnected = wsConfig.onconnected;\n    var onerror = wsConfig.onerror;\n\n    configuration.rpc.pull = function(params, request) {\n        request.reply(null, \"push\");\n    }\n\n    wsConfig.onreconnecting = function() {\n        Logger.debug(\"--------- ONRECONNECTING -----------\");\n        if (status === RECONNECTING) {\n            Logger.error(\"Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it\");\n            return;\n        }\n\n        status = RECONNECTING;\n        if (onreconnecting) {\n            onreconnecting();\n        }\n    }\n\n    wsConfig.onreconnected = function() {\n        Logger.debug(\"--------- ONRECONNECTED -----------\");\n        if (status === CONNECTED) {\n            Logger.error(\"Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it\");\n            return;\n        }\n        status = CONNECTED;\n\n        enabledPings = true;\n        updateNotReconnectIfLessThan();\n        usePing();\n\n        if (onreconnected) {\n            onreconnected();\n        }\n    }\n\n    wsConfig.onconnected = function() {\n        Logger.debug(\"--------- ONCONNECTED -----------\");\n        if (status === CONNECTED) {\n            Logger.error(\"Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it\");\n            return;\n        }\n        status = CONNECTED;\n\n        enabledPings = true;\n        usePing();\n\n        if (onconnected) {\n            onconnected();\n        }\n    }\n\n    wsConfig.onerror = function(error) {\n        Logger.debug(\"--------- ONERROR -----------\");\n\n        status = DISCONNECTED;\n\n        if (onerror) {\n            onerror(error);\n        }\n    }\n\n    var ws = new WebSocketWithReconnection(wsConfig);\n\n    Logger.debug('Connecting websocket to URI: ' + wsConfig.uri);\n\n    var rpcBuilderOptions = {\n        request_timeout: configuration.rpc.requestTimeout,\n        ping_request_timeout: configuration.rpc.heartbeatRequestTimeout\n    };\n\n    var rpc = new RpcBuilder(RpcBuilder.packers.JsonRPC, rpcBuilderOptions, ws,\n        function(request) {\n\n            Logger.debug('Received request: ' + JSON.stringify(request));\n\n            try {\n                var func = configuration.rpc[request.method];\n\n                if (func === undefined) {\n                    Logger.error(\"Method \" + request.method + \" not registered in client\");\n                } else {\n                    func(request.params, request);\n                }\n            } catch (err) {\n                Logger.error('Exception processing request: ' + JSON.stringify(request));\n                Logger.error(err);\n            }\n        });\n\n    this.send = function(method, params, callback) {\n        if (method !== 'ping') {\n            Logger.debug('Request: method:' + method + \" params:\" + JSON.stringify(params));\n        }\n\n        var requestTime = Date.now();\n\n        rpc.encode(method, params, function(error, result) {\n            if (error) {\n                try {\n                    Logger.error(\"ERROR:\" + error.message + \" in Request: method:\" +\n                        method + \" params:\" + JSON.stringify(params) + \" request:\" +\n                        error.request);\n                    if (error.data) {\n                        Logger.error(\"ERROR DATA:\" + JSON.stringify(error.data));\n                    }\n                } catch (e) {}\n                error.requestTime = requestTime;\n            }\n            if (callback) {\n                if (result != undefined && result.value !== 'pong') {\n                    Logger.debug('Response: ' + JSON.stringify(result));\n                }\n                callback(error, result);\n            }\n        });\n    }\n\n    function updateNotReconnectIfLessThan() {\n        Logger.debug(\"notReconnectIfNumLessThan = \" + pingNextNum + ' (old=' +\n            notReconnectIfNumLessThan + ')');\n        notReconnectIfNumLessThan = pingNextNum;\n    }\n\n    function sendPing() {\n        if (enabledPings) {\n            var params = null;\n            if (pingNextNum == 0 || pingNextNum == notReconnectIfNumLessThan) {\n                params = {\n                    interval: configuration.heartbeat || PING_INTERVAL\n                };\n            }\n            pingNextNum++;\n\n            self.send('ping', params, (function(pingNum) {\n                return function(error, result) {\n                    if (error) {\n                        Logger.debug(\"Error in ping request #\" + pingNum + \" (\" +\n                            error.message + \")\");\n                        if (pingNum > notReconnectIfNumLessThan) {\n                            enabledPings = false;\n                            updateNotReconnectIfLessThan();\n                            Logger.debug(\"Server did not respond to ping message #\" +\n                                pingNum + \". Reconnecting... \");\n                            ws.reconnectWs();\n                        }\n                    }\n                }\n            })(pingNextNum));\n        } else {\n            Logger.debug(\"Trying to send ping, but ping is not enabled\");\n        }\n    }\n\n    /*\n    * If configuration.hearbeat has any value, the ping-pong will work with the interval\n    * of configuration.hearbeat\n    */\n    function usePing() {\n        if (!pingPongStarted) {\n            Logger.debug(\"Starting ping (if configured)\")\n            pingPongStarted = true;\n\n            if (configuration.heartbeat != undefined) {\n                pingInterval = setInterval(sendPing, configuration.heartbeat);\n                sendPing();\n            }\n        }\n    }\n\n    this.close = function() {\n        Logger.debug(\"Closing jsonRpcClient explicitly by client\");\n\n        if (pingInterval != undefined) {\n            Logger.debug(\"Clearing ping interval\");\n            clearInterval(pingInterval);\n        }\n        pingPongStarted = false;\n        enabledPings = false;\n\n        if (configuration.sendCloseMessage) {\n            Logger.debug(\"Sending close message\")\n            this.send('closeSession', null, function(error, result) {\n                if (error) {\n                    Logger.error(\"Error sending close message: \" + JSON.stringify(error));\n                }\n                ws.close();\n            });\n        } else {\n\t\t\tws.close();\n        }\n    }\n\n    // This method is only for testing\n    this.forceClose = function(millis) {\n        ws.forceClose(millis);\n    }\n\n    this.reconnect = function() {\n        ws.reconnectWs();\n    }\n}\n\n\nmodule.exports = JsonRpcClient;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nvar WebSocketWithReconnection  = require('./webSocketWithReconnection');\n\n\nexports.WebSocketWithReconnection  = WebSocketWithReconnection;","/*\n * (C) Copyright 2013-2015 Kurento (http://kurento.org/)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\"use strict\";\n\nvar BrowserWebSocket = global.WebSocket || global.MozWebSocket;\n\nvar Logger = console;\n\n/**\n * Get either the `WebSocket` or `MozWebSocket` globals\n * in the browser or try to resolve WebSocket-compatible\n * interface exposed by `ws` for Node-like environment.\n */\n\nvar WebSocket = BrowserWebSocket;\nif (!WebSocket && typeof window === 'undefined') {\n    try {\n        WebSocket = require('ws');\n    } catch (e) { }\n}\n\n//var SockJS = require('sockjs-client');\n\nvar MAX_RETRIES = 2000; // Forever...\nvar RETRY_TIME_MS = 3000; // FIXME: Implement exponential wait times...\n\nvar CONNECTING = 0;\nvar OPEN = 1;\nvar CLOSING = 2;\nvar CLOSED = 3;\n\n/*\nconfig = {\n\t\turi : wsUri,\n\t\tuseSockJS : true (use SockJS) / false (use WebSocket) by default,\n\t\tonconnected : callback method to invoke when connection is successful,\n\t\tondisconnect : callback method to invoke when the connection is lost,\n\t\tonreconnecting : callback method to invoke when the client is reconnecting,\n\t\tonreconnected : callback method to invoke when the client succesfully reconnects,\n\t};\n*/\nfunction WebSocketWithReconnection(config) {\n\n    var closing = false;\n    var registerMessageHandler;\n    var wsUri = config.uri;\n    var useSockJS = config.useSockJS;\n    var reconnecting = false;\n\n    var forcingDisconnection = false;\n\n    var ws;\n\n    if (useSockJS) {\n        ws = new SockJS(wsUri);\n    } else {\n        ws = new WebSocket(wsUri);\n    }\n\n    ws.onopen = function() {\n        logConnected(ws, wsUri);\n        if (config.onconnected) {\n            config.onconnected();\n        }\n    };\n\n    ws.onerror = function(error) {\n        Logger.error(\"Could not connect to \" + wsUri + \" (invoking onerror if defined)\", error);\n        if (config.onerror) {\n            config.onerror(error);\n        }\n    };\n\n    function logConnected(ws, wsUri) {\n        try {\n            Logger.debug(\"WebSocket connected to \" + wsUri);\n        } catch (e) {\n            Logger.error(e);\n        }\n    }\n\n    var reconnectionOnClose = function() {\n        if (ws.readyState === CLOSED) {\n            if (closing) {\n                Logger.debug(\"Connection closed by user\");\n            } else {\n                Logger.debug(\"Connection closed unexpectecly. Reconnecting...\");\n                reconnectToSameUri(MAX_RETRIES, 1);\n            }\n        } else {\n            Logger.debug(\"Close callback from previous websocket. Ignoring it\");\n        }\n    };\n\n    ws.onclose = reconnectionOnClose;\n\n    function reconnectToSameUri(maxRetries, numRetries) {\n        Logger.debug(\"reconnectToSameUri (attempt #\" + numRetries + \", max=\" + maxRetries + \")\");\n\n        if (numRetries === 1) {\n            if (reconnecting) {\n                Logger.warn(\"Trying to reconnectToNewUri when reconnecting... Ignoring this reconnection.\")\n                return;\n            } else {\n                reconnecting = true;\n            }\n\n            if (config.onreconnecting) {\n                config.onreconnecting();\n            }\n        }\n\n        if (forcingDisconnection) {\n            reconnectToNewUri(maxRetries, numRetries, wsUri);\n\n        } else {\n            if (config.newWsUriOnReconnection) {\n                config.newWsUriOnReconnection(function(error, newWsUri) {\n\n                    if (error) {\n                        Logger.debug(error);\n                        setTimeout(function() {\n                            reconnectToSameUri(maxRetries, numRetries + 1);\n                        }, RETRY_TIME_MS);\n                    } else {\n                        reconnectToNewUri(maxRetries, numRetries, newWsUri);\n                    }\n                })\n            } else {\n                reconnectToNewUri(maxRetries, numRetries, wsUri);\n            }\n        }\n    }\n\n    // TODO Test retries. How to force not connection?\n    function reconnectToNewUri(maxRetries, numRetries, reconnectWsUri) {\n        Logger.debug(\"Reconnection attempt #\" + numRetries);\n\n        ws.close();\n\n        wsUri = reconnectWsUri || wsUri;\n\n        var newWs;\n        if (useSockJS) {\n            newWs = new SockJS(wsUri);\n        } else {\n            newWs = new WebSocket(wsUri);\n        }\n\n        newWs.onopen = function() {\n            Logger.debug(\"Reconnected after \" + numRetries + \" attempts...\");\n            logConnected(newWs, wsUri);\n            reconnecting = false;\n            registerMessageHandler();\n            if (config.onreconnected()) {\n                config.onreconnected();\n            }\n\n            newWs.onclose = reconnectionOnClose;\n        };\n\n        var onErrorOrClose = function(error) {\n            Logger.warn(\"Reconnection error: \", error);\n\n            if (numRetries === maxRetries) {\n                if (config.ondisconnect) {\n                    config.ondisconnect();\n                }\n            } else {\n                setTimeout(function() {\n                    reconnectToSameUri(maxRetries, numRetries + 1);\n                }, RETRY_TIME_MS);\n            }\n        };\n\n        newWs.onerror = onErrorOrClose;\n\n        ws = newWs;\n    }\n\n    this.close = function() {\n        closing = true;\n        ws.close();\n    };\n\n\n    // This method is only for testing\n    this.forceClose = function(millis) {\n        Logger.debug(\"Testing: Force WebSocket close\");\n\n        if (millis) {\n            Logger.debug(\"Testing: Change wsUri for \" + millis + \" millis to simulate net failure\");\n            var goodWsUri = wsUri;\n            wsUri = \"wss://21.234.12.34.4:443/\";\n\n            forcingDisconnection = true;\n\n            setTimeout(function() {\n                Logger.debug(\"Testing: Recover good wsUri \" + goodWsUri);\n                wsUri = goodWsUri;\n\n                forcingDisconnection = false;\n\n            }, millis);\n        }\n\n        ws.close();\n    };\n\n    this.reconnectWs = function() {\n        Logger.debug(\"reconnectWs\");\n        reconnectToSameUri(MAX_RETRIES, 1, wsUri);\n    };\n\n    this.send = function(message) {\n        ws.send(message);\n    };\n\n    this.addEventListener = function(type, callback) {\n        registerMessageHandler = function() {\n            ws.addEventListener(type, callback);\n        };\n\n        registerMessageHandler();\n    };\n}\n\nmodule.exports = WebSocketWithReconnection;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\n\nvar defineProperty_IE8 = false\nif(Object.defineProperty)\n{\n  try\n  {\n    Object.defineProperty({}, \"x\", {});\n  }\n  catch(e)\n  {\n    defineProperty_IE8 = true\n  }\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function(oThis) {\n    if (typeof this !== 'function') {\n      // closest thing possible to the ECMAScript 5\n      // internal IsCallable function\n      throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n    }\n\n    var aArgs   = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP    = function() {},\n        fBound  = function() {\n          return fToBind.apply(this instanceof fNOP && oThis\n                 ? this\n                 : oThis,\n                 aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n\n    return fBound;\n  };\n}\n\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar inherits = require('inherits');\n\nvar packers = require('./packers');\nvar Mapper = require('./Mapper');\n\n\nvar BASE_TIMEOUT = 5000;\n\n\nfunction unifyResponseMethods(responseMethods)\n{\n  if(!responseMethods) return {};\n\n  for(var key in responseMethods)\n  {\n    var value = responseMethods[key];\n\n    if(typeof value == 'string')\n      responseMethods[key] =\n      {\n        response: value\n      }\n  };\n\n  return responseMethods;\n};\n\nfunction unifyTransport(transport)\n{\n  if(!transport) return;\n\n  // Transport as a function\n  if(transport instanceof Function)\n    return {send: transport};\n\n  // WebSocket & DataChannel\n  if(transport.send instanceof Function)\n    return transport;\n\n  // Message API (Inter-window & WebWorker)\n  if(transport.postMessage instanceof Function)\n  {\n    transport.send = transport.postMessage;\n    return transport;\n  }\n\n  // Stream API\n  if(transport.write instanceof Function)\n  {\n    transport.send = transport.write;\n    return transport;\n  }\n\n  // Transports that only can receive messages, but not send\n  if(transport.onmessage !== undefined) return;\n  if(transport.pause instanceof Function) return;\n\n  throw new SyntaxError(\"Transport is not a function nor a valid object\");\n};\n\n\n/**\n * Representation of a RPC notification\n *\n * @class\n *\n * @constructor\n *\n * @param {String} method -method of the notification\n * @param params - parameters of the notification\n */\nfunction RpcNotification(method, params)\n{\n  if(defineProperty_IE8)\n  {\n    this.method = method\n    this.params = params\n  }\n  else\n  {\n    Object.defineProperty(this, 'method', {value: method, enumerable: true});\n    Object.defineProperty(this, 'params', {value: params, enumerable: true});\n  }\n};\n\n\n/**\n * @class\n *\n * @constructor\n *\n * @param {object} packer\n *\n * @param {object} [options]\n *\n * @param {object} [transport]\n *\n * @param {Function} [onRequest]\n */\nfunction RpcBuilder(packer, options, transport, onRequest)\n{\n  var self = this;\n\n  if(!packer)\n    throw new SyntaxError('Packer is not defined');\n\n  if(!packer.pack || !packer.unpack)\n    throw new SyntaxError('Packer is invalid');\n\n  var responseMethods = unifyResponseMethods(packer.responseMethods);\n\n\n  if(options instanceof Function)\n  {\n    if(transport != undefined)\n      throw new SyntaxError(\"There can't be parameters after onRequest\");\n\n    onRequest = options;\n    transport = undefined;\n    options   = undefined;\n  };\n\n  if(options && options.send instanceof Function)\n  {\n    if(transport && !(transport instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n    onRequest = transport;\n    transport = options;\n    options   = undefined;\n  };\n\n  if(transport instanceof Function)\n  {\n    if(onRequest != undefined)\n      throw new SyntaxError(\"There can't be parameters after onRequest\");\n\n    onRequest = transport;\n    transport = undefined;\n  };\n\n  if(transport && transport.send instanceof Function)\n    if(onRequest && !(onRequest instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n  options = options || {};\n\n\n  EventEmitter.call(this);\n\n  if(onRequest)\n    this.on('request', onRequest);\n\n\n  if(defineProperty_IE8)\n    this.peerID = options.peerID\n  else\n    Object.defineProperty(this, 'peerID', {value: options.peerID});\n\n  var max_retries = options.max_retries || 0;\n\n\n  function transportMessage(event)\n  {\n    self.decode(event.data || event);\n  };\n\n  this.getTransport = function()\n  {\n    return transport;\n  }\n  this.setTransport = function(value)\n  {\n    // Remove listener from old transport\n    if(transport)\n    {\n      // W3C transports\n      if(transport.removeEventListener)\n        transport.removeEventListener('message', transportMessage);\n\n      // Node.js Streams API\n      else if(transport.removeListener)\n        transport.removeListener('data', transportMessage);\n    };\n\n    // Set listener on new transport\n    if(value)\n    {\n      // W3C transports\n      if(value.addEventListener)\n        value.addEventListener('message', transportMessage);\n\n      // Node.js Streams API\n      else if(value.addListener)\n        value.addListener('data', transportMessage);\n    };\n\n    transport = unifyTransport(value);\n  }\n\n  if(!defineProperty_IE8)\n    Object.defineProperty(this, 'transport',\n    {\n      get: this.getTransport.bind(this),\n      set: this.setTransport.bind(this)\n    })\n\n  this.setTransport(transport);\n\n\n  var request_timeout      = options.request_timeout      || BASE_TIMEOUT;\n  var ping_request_timeout = options.ping_request_timeout || request_timeout;\n  var response_timeout     = options.response_timeout     || BASE_TIMEOUT;\n  var duplicates_timeout   = options.duplicates_timeout   || BASE_TIMEOUT;\n\n\n  var requestID = 0;\n\n  var requests  = new Mapper();\n  var responses = new Mapper();\n  var processedResponses = new Mapper();\n\n  var message2Key = {};\n\n\n  /**\n   * Store the response to prevent to process duplicate request later\n   */\n  function storeResponse(message, id, dest)\n  {\n    var response =\n    {\n      message: message,\n      /** Timeout to auto-clean old responses */\n      timeout: setTimeout(function()\n      {\n        responses.remove(id, dest);\n      },\n      response_timeout)\n    };\n\n    responses.set(response, id, dest);\n  };\n\n  /**\n   * Store the response to ignore duplicated messages later\n   */\n  function storeProcessedResponse(ack, from)\n  {\n    var timeout = setTimeout(function()\n    {\n      processedResponses.remove(ack, from);\n    },\n    duplicates_timeout);\n\n    processedResponses.set(timeout, ack, from);\n  };\n\n\n  /**\n   * Representation of a RPC request\n   *\n   * @class\n   * @extends RpcNotification\n   *\n   * @constructor\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param {Integer} id - identifier of the request\n   * @param [from] - source of the notification\n   */\n  function RpcRequest(method, params, id, from, transport)\n  {\n    RpcNotification.call(this, method, params);\n\n    this.getTransport = function()\n    {\n      return transport;\n    }\n    this.setTransport = function(value)\n    {\n      transport = unifyTransport(value);\n    }\n\n    if(!defineProperty_IE8)\n      Object.defineProperty(this, 'transport',\n      {\n        get: this.getTransport.bind(this),\n        set: this.setTransport.bind(this)\n      })\n\n    var response = responses.get(id, from);\n\n    /**\n     * @constant {Boolean} duplicated\n     */\n    if(!(transport || self.getTransport()))\n    {\n      if(defineProperty_IE8)\n        this.duplicated = Boolean(response)\n      else\n        Object.defineProperty(this, 'duplicated',\n        {\n          value: Boolean(response)\n        });\n    }\n\n    var responseMethod = responseMethods[method];\n\n    this.pack = packer.pack.bind(packer, this, id)\n\n    /**\n     * Generate a response to this request\n     *\n     * @param {Error} [error]\n     * @param {*} [result]\n     *\n     * @returns {string}\n     */\n    this.reply = function(error, result, transport)\n    {\n      // Fix optional parameters\n      if(error instanceof Function || error && error.send instanceof Function)\n      {\n        if(result != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = error;\n        result = null;\n        error = undefined;\n      }\n\n      else if(result instanceof Function\n      || result && result.send instanceof Function)\n      {\n        if(transport != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = result;\n        result = null;\n      };\n\n      transport = unifyTransport(transport);\n\n      // Duplicated request, remove old response timeout\n      if(response)\n        clearTimeout(response.timeout);\n\n      if(from != undefined)\n      {\n        if(error)\n          error.dest = from;\n\n        if(result)\n          result.dest = from;\n      };\n\n      var message;\n\n      // New request or overriden one, create new response with provided data\n      if(error || result != undefined)\n      {\n        if(self.peerID != undefined)\n        {\n          if(error)\n            error.from = self.peerID;\n          else\n            result.from = self.peerID;\n        }\n\n        // Protocol indicates that responses has own request methods\n        if(responseMethod)\n        {\n          if(responseMethod.error == undefined && error)\n            message =\n            {\n              error: error\n            };\n\n          else\n          {\n            var method = error\n                       ? responseMethod.error\n                       : responseMethod.response;\n\n            message =\n            {\n              method: method,\n              params: error || result\n            };\n          }\n        }\n        else\n          message =\n          {\n            error:  error,\n            result: result\n          };\n\n        message = packer.pack(message, id);\n      }\n\n      // Duplicate & not-overriden request, re-send old response\n      else if(response)\n        message = response.message;\n\n      // New empty reply, response null value\n      else\n        message = packer.pack({result: null}, id);\n\n      // Store the response to prevent to process a duplicated request later\n      storeResponse(message, id, from);\n\n      // Return the stored response so it can be directly send back\n      transport = transport || this.getTransport() || self.getTransport();\n\n      if(transport)\n        return transport.send(message);\n\n      return message;\n    }\n  };\n  inherits(RpcRequest, RpcNotification);\n\n\n  function cancel(message)\n  {\n    var key = message2Key[message];\n    if(!key) return;\n\n    delete message2Key[message];\n\n    var request = requests.pop(key.id, key.dest);\n    if(!request) return;\n\n    clearTimeout(request.timeout);\n\n    // Start duplicated responses timeout\n    storeProcessedResponse(key.id, key.dest);\n  };\n\n  /**\n   * Allow to cancel a request and don't wait for a response\n   *\n   * If `message` is not given, cancel all the request\n   */\n  this.cancel = function(message)\n  {\n    if(message) return cancel(message);\n\n    for(var message in message2Key)\n      cancel(message);\n  };\n\n\n  this.close = function()\n  {\n    // Prevent to receive new messages\n    var transport = this.getTransport();\n    if(transport && transport.close)\n       transport.close();\n\n    // Request & processed responses\n    this.cancel();\n\n    processedResponses.forEach(clearTimeout);\n\n    // Responses\n    responses.forEach(function(response)\n    {\n      clearTimeout(response.timeout);\n    });\n  };\n\n\n  /**\n   * Generates and encode a JsonRPC 2.0 message\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param [dest] - destination of the notification\n   * @param {object} [transport] - transport where to send the message\n   * @param [callback] - function called when a response to this request is\n   *   received. If not defined, a notification will be send instead\n   *\n   * @returns {string} A raw JsonRPC 2.0 request or notification string\n   */\n  this.encode = function(method, params, dest, transport, callback)\n  {\n    // Fix optional parameters\n    if(params instanceof Function)\n    {\n      if(dest != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = params;\n      transport = undefined;\n      dest      = undefined;\n      params    = undefined;\n    }\n\n    else if(dest instanceof Function)\n    {\n      if(transport != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = dest;\n      transport = undefined;\n      dest      = undefined;\n    }\n\n    else if(transport instanceof Function)\n    {\n      if(callback != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = transport;\n      transport = undefined;\n    };\n\n    if(self.peerID != undefined)\n    {\n      params = params || {};\n\n      params.from = self.peerID;\n    };\n\n    if(dest != undefined)\n    {\n      params = params || {};\n\n      params.dest = dest;\n    };\n\n    // Encode message\n    var message =\n    {\n      method: method,\n      params: params\n    };\n\n    if(callback)\n    {\n      var id = requestID++;\n      var retried = 0;\n\n      message = packer.pack(message, id);\n\n      function dispatchCallback(error, result)\n      {\n        self.cancel(message);\n\n        callback(error, result);\n      };\n\n      var request =\n      {\n        message:         message,\n        callback:        dispatchCallback,\n        responseMethods: responseMethods[method] || {}\n      };\n\n      var encode_transport = unifyTransport(transport);\n\n      function sendRequest(transport)\n      {\n        var rt = (method === 'ping' ? ping_request_timeout : request_timeout);\n        request.timeout = setTimeout(timeout, rt*Math.pow(2, retried++));\n        message2Key[message] = {id: id, dest: dest};\n        requests.set(request, id, dest);\n\n        transport = transport || encode_transport || self.getTransport();\n        if(transport)\n          return transport.send(message);\n\n        return message;\n      };\n\n      function retry(transport)\n      {\n        transport = unifyTransport(transport);\n\n        console.warn(retried+' retry for request message:',message);\n\n        var timeout = processedResponses.pop(id, dest);\n        clearTimeout(timeout);\n\n        return sendRequest(transport);\n      };\n\n      function timeout()\n      {\n        if(retried < max_retries)\n          return retry(transport);\n\n        var error = new Error('Request has timed out');\n            error.request = message;\n\n        error.retry = retry;\n\n        dispatchCallback(error)\n      };\n\n      return sendRequest(transport);\n    };\n\n    // Return the packed message\n    message = packer.pack(message);\n\n    transport = transport || this.getTransport();\n    if(transport)\n      return transport.send(message);\n\n    return message;\n  };\n\n  /**\n   * Decode and process a JsonRPC 2.0 message\n   *\n   * @param {string} message - string with the content of the message\n   *\n   * @returns {RpcNotification|RpcRequest|undefined} - the representation of the\n   *   notification or the request. If a response was processed, it will return\n   *   `undefined` to notify that it was processed\n   *\n   * @throws {TypeError} - Message is not defined\n   */\n  this.decode = function(message, transport)\n  {\n    if(!message)\n      throw new TypeError(\"Message is not defined\");\n\n    try\n    {\n      message = packer.unpack(message);\n    }\n    catch(e)\n    {\n      // Ignore invalid messages\n      return console.debug(e, message);\n    };\n\n    var id     = message.id;\n    var ack    = message.ack;\n    var method = message.method;\n    var params = message.params || {};\n\n    var from = params.from;\n    var dest = params.dest;\n\n    // Ignore messages send by us\n    if(self.peerID != undefined && from == self.peerID) return;\n\n    // Notification\n    if(id == undefined && ack == undefined)\n    {\n      var notification = new RpcNotification(method, params);\n\n      if(self.emit('request', notification)) return;\n      return notification;\n    };\n\n\n    function processRequest()\n    {\n      // If we have a transport and it's a duplicated request, reply inmediatly\n      transport = unifyTransport(transport) || self.getTransport();\n      if(transport)\n      {\n        var response = responses.get(id, from);\n        if(response)\n          return transport.send(response.message);\n      };\n\n      var idAck = (id != undefined) ? id : ack;\n      var request = new RpcRequest(method, params, idAck, from, transport);\n\n      if(self.emit('request', request)) return;\n      return request;\n    };\n\n    function processResponse(request, error, result)\n    {\n      request.callback(error, result);\n    };\n\n    function duplicatedResponse(timeout)\n    {\n      console.warn(\"Response already processed\", message);\n\n      // Update duplicated responses timeout\n      clearTimeout(timeout);\n      storeProcessedResponse(ack, from);\n    };\n\n\n    // Request, or response with own method\n    if(method)\n    {\n      // Check if it's a response with own method\n      if(dest == undefined || dest == self.peerID)\n      {\n        var request = requests.get(ack, from);\n        if(request)\n        {\n          var responseMethods = request.responseMethods;\n\n          if(method == responseMethods.error)\n            return processResponse(request, params);\n\n          if(method == responseMethods.response)\n            return processResponse(request, null, params);\n\n          return processRequest();\n        }\n\n        var processed = processedResponses.get(ack, from);\n        if(processed)\n          return duplicatedResponse(processed);\n      }\n\n      // Request\n      return processRequest();\n    };\n\n    var error  = message.error;\n    var result = message.result;\n\n    // Ignore responses not send to us\n    if(error  && error.dest  && error.dest  != self.peerID) return;\n    if(result && result.dest && result.dest != self.peerID) return;\n\n    // Response\n    var request = requests.get(ack, from);\n    if(!request)\n    {\n      var processed = processedResponses.get(ack, from);\n      if(processed)\n        return duplicatedResponse(processed);\n\n      return console.warn(\"No callback was defined for this message\", message);\n    };\n\n    // Process response\n    processResponse(request, error, result);\n  };\n};\ninherits(RpcBuilder, EventEmitter);\n\n\nRpcBuilder.RpcNotification = RpcNotification;\n\n\nmodule.exports = RpcBuilder;\n\nvar clients = require('./clients');\nvar transports = require('./clients/transports');\n\nRpcBuilder.clients = clients;\nRpcBuilder.clients.transports = transports;\nRpcBuilder.packers = packers;\n","/**\n * JsonRPC 2.0 packer\n */\n\n/**\n * Pack a JsonRPC 2.0 message\n *\n * @param {Object} message - object to be packaged. It requires to have all the\n *   fields needed by the JsonRPC 2.0 message that it's going to be generated\n *\n * @return {String} - the stringified JsonRPC 2.0 message\n */\nfunction pack(message, id)\n{\n  var result =\n  {\n    jsonrpc: \"2.0\"\n  };\n\n  // Request\n  if(message.method)\n  {\n    result.method = message.method;\n\n    if(message.params)\n      result.params = message.params;\n\n    // Request is a notification\n    if(id != undefined)\n      result.id = id;\n  }\n\n  // Response\n  else if(id != undefined)\n  {\n    if(message.error)\n    {\n      if(message.result !== undefined)\n        throw new TypeError(\"Both result and error are defined\");\n\n      result.error = message.error;\n    }\n    else if(message.result !== undefined)\n      result.result = message.result;\n    else\n      throw new TypeError(\"No result or error is defined\");\n\n    result.id = id;\n  };\n\n  return JSON.stringify(result);\n};\n\n/**\n * Unpack a JsonRPC 2.0 message\n *\n * @param {String} message - string with the content of the JsonRPC 2.0 message\n *\n * @throws {TypeError} - Invalid JsonRPC version\n *\n * @return {Object} - object filled with the JsonRPC 2.0 message content\n */\nfunction unpack(message)\n{\n  var result = message;\n\n  if(typeof message === 'string' || message instanceof String) {\n    result = JSON.parse(message);\n  }\n\n  // Check if it's a valid message\n\n  var version = result.jsonrpc;\n  if(version !== '2.0')\n    throw new TypeError(\"Invalid JsonRPC version '\" + version + \"': \" + message);\n\n  // Response\n  if(result.method == undefined)\n  {\n    if(result.id == undefined)\n      throw new TypeError(\"Invalid message: \"+message);\n\n    var result_defined = result.result !== undefined;\n    var error_defined  = result.error  !== undefined;\n\n    // Check only result or error is defined, not both or none\n    if(result_defined && error_defined)\n      throw new TypeError(\"Both result and error are defined: \"+message);\n\n    if(!result_defined && !error_defined)\n      throw new TypeError(\"No result or error is defined: \"+message);\n\n    result.ack = result.id;\n    delete result.id;\n  }\n\n  // Return unpacked message\n  return result;\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","function pack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\nfunction unpack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","var JsonRPC = require('./JsonRPC');\nvar XmlRPC  = require('./XmlRPC');\n\n\nexports.JsonRPC = JsonRPC;\nexports.XmlRPC  = XmlRPC;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n"]}