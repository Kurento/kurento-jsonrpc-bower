{"version":3,"file":"bundle.js","sources":["../node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","../lib/index.js","../lib/Mapper.js","../node_modules/grunt-browserify/node_modules/browserify/node_modules/events/events.js","../lib/packers/index.js","../lib/clients/index.js","../lib/packers/JsonRPC.js","../lib/packers/XmlRPC.js","../lib/clients/jsonrpcclient.js","../node_modules/inherits/inherits_browser.js","../node_modules/ws/lib/browser.js"],"names":["unifyResponseMethods","responseMethods","key","value","response","unifyTransport","transport","Function","send","postMessage","write","undefined","onmessage","pause","SyntaxError","RpcNotification","method","params","Object","defineProperty","this","enumerable","RpcBuilder","packer","options","onRequest","transportMessage","event","self","decode","data","storeResponse","message","id","dest","timeout","setTimeout","responses","remove","response_timeout","set","storeProcessedResponse","ack","from","processedResponses","duplicates_timeout","RpcRequest","call","get","Boolean","responseMethod","pack","bind","reply","error","result","clearTimeout","peerID","cancel","message2Key","request","requests","pop","unpack","EventEmitter","on","max_retries","removeEventListener","removeListener","addEventListener","addListener","request_timeout","BASE_TIMEOUT","requestID","Mapper","inherits","close","forEach","encode","callback","dispatchCallback","sendRequest","Math","pow","retried","encode_transport","retry","console","warn","Error","processRequest","idAck","emit","processResponse","duplicatedResponse","TypeError","e","debug","notification","processed","require","packers","module","exports","clients","sources","source","key2","ids","keys","length","prototype","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","type","er","handler","len","args","i","listeners","arguments","Array","apply","slice","listener","m","newListener","push","warned","trace","once","g","fired","list","position","splice","removeAllListeners","ret","listenerCount","emitter","JsonRPC","XmlRPC","JsonRpcClient","jsonrpc","JSON","stringify","String","parse","version","result_defined","error_defined","wsUrl","onerror","ws","WebSocket","rpc","create","ctor","superCtor","super_","constructor","writable","configurable","TempCtor","uri","protocols","instance","global","MozWebSocket"],"mappings":"AAAA;AEAA,QAAS0E,UAEP,GAAI+B,KAGJrF,MAAKyD,QAAU,SAASE,GAEtB,IAAI,GAAI7E,KAAOuG,GACf,CACE,GAAIC,GAASD,EAAQvG,EAErB,KAAI,GAAIyG,KAAQD,GACd3B,EAAS2B,EAAOC,MAItBvF,KAAK4B,IAAM,SAASf,EAAIyE,GAEtB,GAAIE,GAAMH,EAAQC,EAClB,OAAU/F,SAAPiG,EACMjG,OAEFiG,EAAI3E,IAGbb,KAAKkB,OAAS,SAASL,EAAIyE,GAEzB,GAAIE,GAAMH,EAAQC,EACR/F,SAAPiG,UAGIA,GAAI3E,GAEPf,OAAO2F,KAAKD,GAAKE,cACZL,GAAQC,KAGnBtF,KAAKoB,IAAM,SAASrC,EAAO8B,EAAIyE,GAE7B,GAAY/F,QAATR,EACD,MAAOiB,MAAKkB,OAAOL,EAAIyE,EAEzB,IAAIE,GAAMH,EAAQC,EACR/F,SAAPiG,IACDH,EAAQC,GAAUE,MAEpBA,EAAI3E,GAAM9B,GAKduE,OAAOqC,UAAUjD,IAAM,SAAS7B,EAAIyE,GAElC,GAAIvG,GAAQiB,KAAK4B,IAAIf,EAAIyE,EACzB,OAAY/F,SAATR,EACMQ,QAETS,KAAKkB,OAAOL,EAAIyE,GAETvG,IAITmG,OAAOC,QAAU7B;;;AGhDjB,GAAI8E,eAAiBpD,QAAQ,kBAG7BG,SAAQiD,cAAiBA;;;AGEzB,QAASA,eAAcS,EAAOxI,EAAWyI,GAEvC,GAAIC,GAAK,GAAIC,WAAUH,EACnBE,GAAG9F,iBAAiB,QAAS6F,EAEjC,IAAIG,GAAM,GAAI/I,YAAWA,WAAW+E,QAAQiD,QAASa,EAAI1I,EAEzDL,MAAKwD,MAAcyF,EAAIzF,MAAMxB,KAAKiH,GAClCjJ,KAAK6D,YAAcoF,EAAIvF,OAAO1B,KAAKiH,GAbrC,GAAI/I,YAAa8E,QAAQ,SAErBgE,UAAYhE,QAAQ,KAexBE,QAAOC,QAAWiD;;;APNlB,QAASxJ,sBAAqBC,GAE5B,IAAIA,EAAiB,QAErB,KAAI,GAAIC,KAAOD,GACf,CACE,GAAIE,GAAQF,EAAgBC,EAET,iBAATC,KACRF,EAAgBC,IAEdE,SAAUD,IAIhB,MAAOF,GAGT,QAASI,gBAAeC,GAEtB,GAAIA,EAAJ,CAGA,GAAGA,YAAqBC,UACtB,OAAQC,KAAMF,EAGhB,IAAGA,EAAUE,eAAgBD,UAC3B,MAAOD,EAGT,IAAGA,EAAUG,sBAAuBF,UAGlC,MADAD,GAAUE,KAAOF,EAAUG,YACpBH,CAIT,IAAGA,EAAUI,gBAAiBH,UAG5B,MADAD,GAAUE,KAAOF,EAAUI,MACpBJ,CAIT,IAA2BK,SAAxBL,EAAUM,aACVN,EAAUO,gBAAiBN,WAE9B,KAAM,IAAIO,aAAY,mDAcxB,QAASC,iBAAgBC,EAAQC,GAE/BC,OAAOC,eAAeC,KAAM,UAAWjB,MAAOa,EAAQK,YAAY,IAClEH,OAAOC,eAAeC,KAAM,UAAWjB,MAAOc,EAAQI,YAAY,IAiBpE,QAASC,YAAWC,EAAQC,EAASlB,EAAWmB,GA4D9C,QAASC,GAAiBC,GAExBC,EAAKC,OAAOF,EAAMG,MAAQH,GA4D5B,QAASI,GAAcC,EAASC,EAAIC,GAElC,GAAI9B,IAEF4B,QAASA,EAETG,QAASC,WAAW,WAElBC,EAAUC,OAAOL,EAAIC,IAEvBK,GAGFF,GAAUG,IAAIpC,EAAU6B,EAAIC,GAM9B,QAASO,GAAuBC,EAAKC,GAEnC,GAAIR,GAAUC,WAAW,WAEvBQ,EAAmBN,OAAOI,EAAKC,IAEjCE,EAEAD,GAAmBJ,IAAIL,EAASO,EAAKC,GAiBvC,QAASG,GAAW9B,EAAQC,EAAQgB,EAAIU,EAAMrC,GAE5CS,gBAAgBgC,KAAK3B,KAAMJ,EAAQC,GAEnCC,OAAOC,eAAeC,KAAM,aAE1B4B,IAAK,WAEH,MAAO1C,IAGTkC,IAAK,SAASrC,GAEZG,EAAYD,eAAeF,KAI/B,IAAIC,GAAWiC,EAAUW,IAAIf,EAAIU,EAK5BrC,IAAasB,EAAKtB,WACrBY,OAAOC,eAAeC,KAAM,cAE1BjB,MAAO8C,QAAQ7C,IAGnB,IAAI8C,GAAiBjD,EAAgBe,EAErCI,MAAK+B,KAAO5B,EAAO4B,KAAKC,KAAK7B,EAAQH,KAAMa,GAU3Cb,KAAKiC,MAAQ,SAASC,EAAOC,EAAQjD,GAGnC,GAAGgD,YAAiB/C,WAAY+C,GAASA,EAAM9C,eAAgBD,UAC/D,CACE,GAAaI,QAAV4C,EACD,KAAM,IAAIzC,aAAY,2CAExBR,GAAYgD,EACZC,EAAS,KACTD,EAAQ3C,WAGL,IAAG4C,YAAkBhD,WACvBgD,GAAUA,EAAO/C,eAAgBD,UACpC,CACE,GAAgBI,QAAbL,EACD,KAAM,IAAIQ,aAAY,2CAExBR,GAAYiD,EACZA,EAAS,KAGXjD,EAAYD,eAAeC,GAGxBF,GACDoD,aAAapD,EAAS+B,SAEbxB,QAARgC,IAEEW,IACDA,EAAMpB,KAAOS,GAEZY,IACDA,EAAOrB,KAAOS,GAGlB,IAAIX,EAGJ,IAAGsB,GAAmB3C,QAAV4C,EACZ,CAUE,GATkB5C,QAAfiB,EAAK6B,SAEHH,EACDA,EAAMX,KAAOf,EAAK6B,OAElBF,EAAOZ,KAAOf,EAAK6B,QAIpBP,EAED,GAA2BvC,QAAxBuC,EAAeI,OAAsBA,EACtCtB,GAEEsB,MAAOA,OAIX,CACE,GAAItC,GAASsC,EACAJ,EAAeI,MACfJ,EAAe9C,QAE5B4B,IAEEhB,OAAQA,EACRC,OAAQqC,GAASC,OAKrBvB,IAEEsB,MAAQA,EACRC,OAAQA,EAGZvB,GAAUT,EAAO4B,KAAKnB,EAASC,OAK/BD,GADM5B,EACIA,EAAS4B,QAITT,EAAO4B,MAAMI,OAAQ,MAAOtB,EAQxC,OALAF,GAAcC,EAASC,EAAIU,GAG3BrC,EAAYA,GAAac,KAAKd,WAAasB,EAAKtB,UAE7CA,EACMA,EAAUE,KAAKwB,GAEjBA,GAMX,QAAS0B,GAAO1B,GAEd,GAAI9B,GAAMyD,EAAY3B,EACtB,IAAI9B,EAAJ,OAEOyD,GAAY3B,EAEnB,IAAI4B,GAAUC,EAASC,IAAI5D,EAAI+B,GAAI/B,EAAIgC,KACnC0B,KAEJJ,aAAaI,EAAQzB,SAGrBM,EAAuBvC,EAAI+B,GAAI/B,EAAIgC,QAnUrC,GAAIN,GAAOR,IAEX,KAAIG,EACF,KAAM,IAAIT,aAAY,wBAExB,KAAIS,EAAO4B,OAAS5B,EAAOwC,OACzB,KAAM,IAAIjD,aAAY,oBAExB,IAAIb,GAAkBD,qBAAqBuB,EAAOtB,gBAGlD,IAAGuB,YAAmBjB,UACtB,CACE,GAAgBI,QAAbL,EACD,KAAM,IAAIQ,aAAY,4CAExBW,GAAYD,EACZlB,EAAYK,OACZa,EAAYb,OAGd,GAAGa,GAAWA,EAAQhB,eAAgBD,UACtC,CACE,GAAGD,KAAeA,YAAqBC,WACrC,KAAM,IAAIO,aAAY,yCAExBW,GAAYnB,EACZA,EAAYkB,EACZA,EAAYb,OAGd,GAAGL,YAAqBC,UACxB,CACE,GAAgBI,QAAbc,EACD,KAAM,IAAIX,aAAY,4CAExBW,GAAYnB,EACZA,EAAYK,OAGd,GAAGL,GAAaA,EAAUE,eAAgBD,WACrCkB,KAAeA,YAAqBlB,WACrC,KAAM,IAAIO,aAAY,yCAE1BU,GAAUA,MAGVwC,aAAajB,KAAK3B,MAEfK,GACDL,KAAK6C,GAAG,UAAWxC,GAGrBP,OAAOC,eAAeC,KAAM,UAAWjB,MAAOqB,EAAQiC,QAEtD,IAAIS,GAAc1C,EAAQ0C,aAAe,CAQzChD,QAAOC,eAAeC,KAAM,aAE1B4B,IAAK,WAEH,MAAO1C,IAGTkC,IAAK,SAASrC,GAGTG,IAGEA,EAAU6D,oBACX7D,EAAU6D,oBAAoB,UAAWzC,GAGnCpB,EAAU8D,gBAChB9D,EAAU8D,eAAe,OAAQ1C,IAIlCvB,IAGEA,EAAMkE,iBACPlE,EAAMkE,iBAAiB,UAAW3C,GAG5BvB,EAAMmE,aACZnE,EAAMmE,YAAY,OAAQ5C,IAG9BpB,EAAYD,eAAeF,MAI/BiB,KAAKd,UAAYA,CAGjB,MAAMiE,GAAqB/C,EAAQ+C,iBAAsBC,aACnDjC,EAAqBf,EAAQe,kBAAsBiC,aACnD3B,EAAqBrB,EAAQqB,oBAAsB2B,YAGzD,IAAIC,GAAY,EAEZZ,EAAY,GAAIa,QAChBrC,EAAY,GAAIqC,QAChB9B,EAAqB,GAAI8B,QAEzBf,IAiMJgB,UAAS7B,EAAY/B,iBAwBrBK,KAAKsC,OAAS,SAAS1B,GAErB,GAAGA,EAAS,MAAO0B,GAAO1B,EAE1B,KAAI,GAAIA,KAAW2B,GACjBD,EAAO1B,IAIXZ,KAAKwD,MAAQ,WAGX,GAAItE,GAAYsB,EAAKtB,SAClBA,IAAaA,EAAUsE,OACvBtE,EAAUsE,QAGbxD,KAAKsC,SAELd,EAAmBiC,QAAQrB,cAG3BnB,EAAUwC,QAAQ,SAASzE,GAEzBoD,aAAapD,EAAS+B,YAiB1Bf,KAAK0D,OAAS,SAAS9D,EAAQC,EAAQiB,EAAM5B,EAAWyE,GA6DpD,QAASC,GAAiB1B,EAAOC,GAE/B3B,EAAK8B,OAAO1B,GAEZ+C,EAASzB,EAAOC,GAYlB,QAAS0B,GAAY3E,GAQnB,MANAsD,GAAQzB,QAAUC,WAAWD,EACAoC,EAAgBW,KAAKC,IAAI,EAAGC,MACzDzB,EAAY3B,IAAYC,GAAIA,EAAIC,KAAMA,GACtC2B,EAASrB,IAAIoB,EAAS3B,EAAIC,GAE1B5B,EAAYA,GAAa+E,GAAoBzD,EAAKtB,UAC/CA,EACMA,EAAUE,KAAKwB,GAEjBA,EAGT,QAASsD,GAAMhF,GAEbA,EAAYD,eAAeC,GAE3BiF,QAAQC,KAAKJ,EAAQ,8BAA8BpD,EAEnD,IAAIG,GAAUS,EAAmBkB,IAAI7B,EAAIC,EAGzC,OAFAsB,cAAarB,GAEN8C,EAAY3E,GAGrB,QAAS6B,KAEP,GAAa+B,EAAVkB,EACD,MAAOE,GAAMhF,EAEf,IAAIgD,GAAQ,GAAImC,OAAM,wBAClBnC,GAAMM,QAAU5B,EAEpBsB,EAAMgC,MAAQA,EAEdN,EAAiB1B,GA9GrB,GAAGrC,YAAkBV,UACrB,CACE,GAAWI,QAARuB,EACD,KAAM,IAAIpB,aAAY,2CAExBiE,GAAY9D,EACZX,EAAYK,OACZuB,EAAYvB,OACZM,EAAYN,WAGT,IAAGuB,YAAgB3B,UACxB,CACE,GAAgBI,QAAbL,EACD,KAAM,IAAIQ,aAAY,2CAExBiE,GAAY7C,EACZ5B,EAAYK,OACZuB,EAAYvB,WAGT,IAAGL,YAAqBC,UAC7B,CACE,GAAeI,QAAZoE,EACD,KAAM,IAAIjE,aAAY,2CAExBiE,GAAYzE,EACZA,EAAYK,OAGIA,QAAfiB,EAAK6B,SAENxC,EAASA,MAETA,EAAO0B,KAAOf,EAAK6B,QAGV9C,QAARuB,IAEDjB,EAASA,MAETA,EAAOiB,KAAOA,EAIhB,IAAIF,IAEFhB,OAAQA,EACRC,OAAQA,EAGV,IAAG8D,EACH,CACE,GAAI9C,GAAKwC,IACLW,EAAU,CAEdpD,GAAUT,EAAO4B,KAAKnB,EAASC,EAS/B,IAAI2B,IAEF5B,QAAiBA,EACjB+C,SAAiBC,EACjB/E,gBAAiBA,EAAgBe,QAG/BqE,EAAmBhF,eAAeC,EAyCtC,OAAO2E,GAAY3E,GAOrB,MAHA0B,GAAUT,EAAO4B,KAAKnB,GAEtB1B,EAAYA,GAAasB,EAAKtB,UAC3BA,EACMA,EAAUE,KAAKwB,GAEjBA,GAcTZ,KAAKS,OAAS,SAASG,EAAS1B,GAoC9B,QAASoF,KAIP,GADApF,EAAYD,eAAeC,IAAcsB,EAAKtB,UAE9C,CACE,GAAIF,GAAWiC,EAAUW,IAAIf,EAAIU,EACjC,IAAGvC,EACD,MAAOE,GAAUE,KAAKJ,EAAS4B,SAGnC,GAAI2D,GAAehF,QAANsB,EAAmBA,EAAKS,EACjCkB,EAAU,GAAId,GAAW9B,EAAQC,EAAQ0E,EAAOhD,EAAMrC,EAE1D,OAAGsB,GAAKgE,KAAK,UAAWhC,GAAxB,OACOA,EAGT,QAASiC,GAAgBjC,EAASN,EAAOC,GAEvCK,EAAQmB,SAASzB,EAAOC,GAG1B,QAASuC,GAAmB3D,GAE1BoD,QAAQC,KAAK,6BAA8BxD,GAG3CwB,aAAarB,GACbM,EAAuBC,EAAKC,GA/D9B,IAAIX,EACF,KAAM,IAAI+D,WAAU,yBAEtB,KAEE/D,EAAUT,EAAOwC,OAAO/B,GAE1B,MAAMgE,GAGJ,MAAOT,SAAQU,MAAMD,EAAGhE,GAG1B,GAAIC,GAASD,EAAQC,GACjBS,EAASV,EAAQU,IACjB1B,EAASgB,EAAQhB,OACjBC,EAASe,EAAQf,WAEjB0B,EAAO1B,EAAO0B,KACdT,EAAOjB,EAAOiB,IAGlB,IAAkBvB,QAAfiB,EAAK6B,QAAuBd,GAAQf,EAAK6B,OAA5C,CAGA,GAAS9C,QAANsB,GAA0BtB,QAAP+B,EACtB,CACE,GAAIwD,GAAe,GAAInF,iBAAgBC,EAAQC,EAE/C,IAAGW,EAAKgE,KAAK,UAAWM,GAAe,MACvC,OAAOA,GAsCT,GAAGlF,EACH,CAEE,GAAWL,QAARuB,GAAqBA,GAAQN,EAAK6B,OACrC,CACE,GAAIG,GAAUC,EAASb,IAAIN,EAAKC,EAChC,IAAGiB,EACH,CACE,GAAI3D,GAAkB2D,EAAQ3D,eAE9B,OAAGe,IAAUf,EAAgBqD,MACpBuC,EAAgBjC,EAAS3C,GAE/BD,GAAUf,EAAgBG,SACpByF,EAAgBjC,EAAS,KAAM3C,GAEjCyE,IAGT,GAAIS,GAAYvD,EAAmBI,IAAIN,EAAKC,EAC5C,IAAGwD,EACD,MAAOL,GAAmBK,GAI9B,MAAOT,KAGT,GAAIpC,GAAStB,EAAQsB,MACjBC,EAASvB,EAAQuB,MAGrB,MAAGD,GAAUA,EAAMpB,MAASoB,EAAMpB,MAASN,EAAK6B,QAC7CF,GAAUA,EAAOrB,MAAQqB,EAAOrB,MAAQN,EAAK6B,QAAhD,CAGA,GAAIG,GAAUC,EAASb,IAAIN,EAAKC,EAChC,KAAIiB,EACJ,CACE,GAAIuC,GAAYvD,EAAmBI,IAAIN,EAAKC,EAC5C,OAAGwD,GACML,EAAmBK,GAErBZ,QAAQC,KAAK,2CAA4CxD,GAIlE6D,EAAgBjC,EAASN,EAAOC,MAptBpC,GAAIS,cAAeoC,QAAQ,UAAUpC,aAEjCW,SAAWyB,QAAQ,YAEnBC,QAAUD,QAAQ,aAClB1B,OAAS0B,QAAQ,WAGrB,MAAM5B,cAAe,GA+sBrBG,UAASrD,WAAY0C,cAGrB1C,WAAWP,gBAAkBA,gBAG7BuF,OAAOC,QAAUjF,UAEjB,IAAIkF,SAAUJ,QAAQ,YAEtB9E,YAAWkF,QAAUA,QACrBlF,WAAW+E,QAAUA;;;AKruBrB,QAASlD,MAAKnB,EAASC,GAErB,GAAIsB,IAEFkG,QAAS,MAIX,IAAGzH,EAAQhB,OAETuC,EAAOvC,OAASgB,EAAQhB,OAErBgB,EAAQf,SACTsC,EAAOtC,OAASe,EAAQf,QAGjBN,QAANsB,IACDsB,EAAOtB,GAAKA,OAIX,IAAStB,QAANsB,EACR,CACE,GAAGD,EAAQsB,MACX,CACE,GAAsB3C,SAAnBqB,EAAQuB,OACT,KAAM,IAAIwC,WAAU,oCAEtBxC,GAAOD,MAAQtB,EAAQsB,UAEpB,CAAA,GAAsB3C,SAAnBqB,EAAQuB,OAGd,KAAM,IAAIwC,WAAU,gCAFpBxC,GAAOA,OAASvB,EAAQuB,OAI1BA,EAAOtB,GAAKA,EAGd,MAAOyH,MAAKC,UAAUpG,GAYxB,QAASQ,QAAO/B,GAEd,GAAIuB,GAASvB,GAEQ,gBAAXA,IAAuBA,YAAmB4H,WAClDrG,EAASmG,KAAKG,MAAM7H,GAItB,IAAI8H,GAAUvG,EAAOkG,OACrB,IAAc,OAAXK,EACD,KAAM,IAAI/D,WAAU,4BAA4B+D,EAAQ,MAAM9H,EAGhE,IAAoBrB,QAAjB4C,EAAOvC,OACV,CACE,GAAgBL,QAAb4C,EAAOtB,GACR,KAAM,IAAI8D,WAAU,oBAAoB/D,EAE1C,IAAI+H,GAAmCpJ,SAAlB4C,EAAOA,OACxByG,EAAmCrJ,SAAlB4C,EAAOD,KAG5B,IAAGyG,GAAkBC,EACnB,KAAM,IAAIjE,WAAU,sCAAsC/D,EAE5D,KAAI+H,IAAmBC,EACrB,KAAM,IAAIjE,WAAU,kCAAkC/D,EAExDuB,GAAOb,IAAMa,EAAOtB,SACbsB,GAAOtB,GAIhB,MAAOsB,GAITgD,QAAQpD,KAASA,KACjBoD,QAAQxC,OAASA;;;ACrGjB,QAASZ,QAEP,KAAM,IAAI4C,WAAU,uBAGtB,QAAShC,UAEP,KAAM,IAAIgC,WAAU,uBAItBQ,QAAQpD,KAASA,KACjBoD,QAAQxC,OAASA;;;AHZjB,GAAIuF,SAAUlD,QAAQ,aAClBmD,OAAUnD,QAAQ,WAGtBG,SAAQ+C,QAAUA,QAClB/C,QAAQgD,OAAUA;;;ADgBlB,QAASvF,gBACP5C,KAAK4F,QAAU5F,KAAK4F,YACpB5F,KAAK6F,cAAgB7F,KAAK6F,eAAiBtG,OAuQ7C,QAASuG,YAAWC,GAClB,MAAsB,kBAARA,GAGhB,QAASC,UAASD,GAChB,MAAsB,gBAARA,GAGhB,QAASE,UAASF,GAChB,MAAsB,gBAARA,IAA4B,OAARA,EAGpC,QAASG,aAAYH,GACnB,MAAe,UAARA,EAlRTb,OAAOC,QAAUvC,aAGjBA,aAAaA,aAAeA,aAE5BA,aAAa+C,UAAUC,QAAUrG,OACjCqD,aAAa+C,UAAUE,cAAgBtG,OAIvCqD,aAAauD,oBAAsB,GAInCvD,aAAa+C,UAAUS,gBAAkB,SAASC,GAChD,IAAKL,SAASK,IAAU,EAAJA,GAASC,MAAMD,GACjC,KAAM1B,WAAU,8BAElB,OADA3E,MAAK6F,cAAgBQ,EACdrG,MAGT4C,aAAa+C,UAAUnB,KAAO,SAAS+B,GACrC,GAAIC,GAAIC,EAASC,EAAKC,EAAMC,EAAGC,CAM/B,IAJK7G,KAAK4F,UACR5F,KAAK4F,YAGM,UAATW,KACGvG,KAAK4F,QAAQ1D,OACb+D,SAASjG,KAAK4F,QAAQ1D,SAAWlC,KAAK4F,QAAQ1D,MAAMwD,QAAS,CAEhE,GADAc,EAAKM,UAAU,GACXN,YAAcnC,OAChB,KAAMmC,EAER,MAAM7B,WAAU,wCAMpB,GAFA8B,EAAUzG,KAAK4F,QAAQW,GAEnBL,YAAYO,GACd,OAAO,CAET,IAAIX,WAAWW,GACb,OAAQK,UAAUpB,QAEhB,IAAK,GACHe,EAAQ9E,KAAK3B,KACb,MACF,KAAK,GACHyG,EAAQ9E,KAAK3B,KAAM8G,UAAU,GAC7B,MACF,KAAK,GACHL,EAAQ9E,KAAK3B,KAAM8G,UAAU,GAAIA,UAAU,GAC3C,MAEF,SAGE,IAFAJ,EAAMI,UAAUpB,OAChBiB,EAAO,GAAII,OAAML,EAAM,GAClBE,EAAI,EAAOF,EAAJE,EAASA,IACnBD,EAAKC,EAAI,GAAKE,UAAUF,EAC1BH,GAAQO,MAAMhH,KAAM2G,OAEnB,IAAIV,SAASQ,GAAU,CAG5B,IAFAC,EAAMI,UAAUpB,OAChBiB,EAAO,GAAII,OAAML,EAAM,GAClBE,EAAI,EAAOF,EAAJE,EAASA,IACnBD,EAAKC,EAAI,GAAKE,UAAUF,EAI1B,KAFAC,EAAYJ,EAAQQ,QACpBP,EAAMG,EAAUnB,OACXkB,EAAI,EAAOF,EAAJE,EAASA,IACnBC,EAAUD,GAAGI,MAAMhH,KAAM2G,GAG7B,OAAO,GAGT/D,aAAa+C,UAAUzC,YAAc,SAASqD,EAAMW,GAClD,GAAIC,EAEJ,KAAKrB,WAAWoB,GACd,KAAMvC,WAAU,8BAuBlB,IArBK3E,KAAK4F,UACR5F,KAAK4F,YAIH5F,KAAK4F,QAAQwB,aACfpH,KAAKwE,KAAK,cAAe+B,EACfT,WAAWoB,EAASA,UACpBA,EAASA,SAAWA,GAE3BlH,KAAK4F,QAAQW,GAGTN,SAASjG,KAAK4F,QAAQW,IAE7BvG,KAAK4F,QAAQW,GAAMc,KAAKH,GAGxBlH,KAAK4F,QAAQW,IAASvG,KAAK4F,QAAQW,GAAOW,GAN1ClH,KAAK4F,QAAQW,GAAQW,EASnBjB,SAASjG,KAAK4F,QAAQW,MAAWvG,KAAK4F,QAAQW,GAAMe,OAAQ,CAC9D,GAAIH,EAIFA,GAHGjB,YAAYlG,KAAK6F,eAGhBjD,aAAauD,oBAFbnG,KAAK6F,cAKPsB,GAAKA,EAAI,GAAKnH,KAAK4F,QAAQW,GAAMb,OAASyB,IAC5CnH,KAAK4F,QAAQW,GAAMe,QAAS,EAC5BnD,QAAQjC,MAAM,mIAGAlC,KAAK4F,QAAQW,GAAMb,QACJ,kBAAlBvB,SAAQoD,OAEjBpD,QAAQoD,SAKd,MAAOvH,OAGT4C,aAAa+C,UAAU9C,GAAKD,aAAa+C,UAAUzC,YAEnDN,aAAa+C,UAAU6B,KAAO,SAASjB,EAAMW,GAM3C,QAASO,KACPzH,KAAKgD,eAAeuD,EAAMkB,GAErBC,IACHA,GAAQ,EACRR,EAASF,MAAMhH,KAAM8G,YAVzB,IAAKhB,WAAWoB,GACd,KAAMvC,WAAU,8BAElB,IAAI+C,IAAQ,CAcZ,OAHAD,GAAEP,SAAWA,EACblH,KAAK6C,GAAG0D,EAAMkB,GAEPzH,MAIT4C,aAAa+C,UAAU3C,eAAiB,SAASuD,EAAMW,GACrD,GAAIS,GAAMC,EAAUlC,EAAQkB,CAE5B,KAAKd,WAAWoB,GACd,KAAMvC,WAAU,8BAElB,KAAK3E,KAAK4F,UAAY5F,KAAK4F,QAAQW,GACjC,MAAOvG,KAMT,IAJA2H,EAAO3H,KAAK4F,QAAQW,GACpBb,EAASiC,EAAKjC,OACdkC,EAAW,GAEPD,IAAST,GACRpB,WAAW6B,EAAKT,WAAaS,EAAKT,WAAaA,QAC3ClH,MAAK4F,QAAQW,GAChBvG,KAAK4F,QAAQ5C,gBACfhD,KAAKwE,KAAK,iBAAkB+B,EAAMW,OAE/B,IAAIjB,SAAS0B,GAAO,CACzB,IAAKf,EAAIlB,EAAQkB,IAAM,GACrB,GAAIe,EAAKf,KAAOM,GACXS,EAAKf,GAAGM,UAAYS,EAAKf,GAAGM,WAAaA,EAAW,CACvDU,EAAWhB,CACX,OAIJ,GAAe,EAAXgB,EACF,MAAO5H,KAEW,KAAhB2H,EAAKjC,QACPiC,EAAKjC,OAAS,QACP1F,MAAK4F,QAAQW,IAEpBoB,EAAKE,OAAOD,EAAU,GAGpB5H,KAAK4F,QAAQ5C,gBACfhD,KAAKwE,KAAK,iBAAkB+B,EAAMW,GAGtC,MAAOlH,OAGT4C,aAAa+C,UAAUmC,mBAAqB,SAASvB,GACnD,GAAIzH,GAAK+H,CAET,KAAK7G,KAAK4F,QACR,MAAO5F,KAGT,KAAKA,KAAK4F,QAAQ5C,eAKhB,MAJyB,KAArB8D,UAAUpB,OACZ1F,KAAK4F,WACE5F,KAAK4F,QAAQW,UACbvG,MAAK4F,QAAQW,GACfvG,IAIT,IAAyB,IAArB8G,UAAUpB,OAAc,CAC1B,IAAK5G,IAAOkB,MAAK4F,QACH,mBAAR9G,GACJkB,KAAK8H,mBAAmBhJ,EAI1B,OAFAkB,MAAK8H,mBAAmB,kBACxB9H,KAAK4F,WACE5F,KAKT,GAFA6G,EAAY7G,KAAK4F,QAAQW,GAErBT,WAAWe,GACb7G,KAAKgD,eAAeuD,EAAMM,OAG1B,MAAOA,EAAUnB,QACf1F,KAAKgD,eAAeuD,EAAMM,EAAUA,EAAUnB,OAAS,GAI3D,cAFO1F,MAAK4F,QAAQW,GAEbvG,MAGT4C,aAAa+C,UAAUkB,UAAY,SAASN,GAC1C,GAAIwB,EAOJ,OAHEA,GAHG/H,KAAK4F,SAAY5F,KAAK4F,QAAQW,GAE1BT,WAAW9F,KAAK4F,QAAQW,KACxBvG,KAAK4F,QAAQW,IAEdvG,KAAK4F,QAAQW,GAAMU,YAI7BrE,aAAaoF,cAAgB,SAASC,EAAS1B,GAC7C,GAAIwB,EAOJ,OAHEA,GAHGE,EAAQrC,SAAYqC,EAAQrC,QAAQW,GAEhCT,WAAWmC,EAAQrC,QAAQW,IAC5B,EAEA0B,EAAQrC,QAAQW,GAAMb,OAJtB;;;AMpRRR,OAAOC,QAFoB,kBAAlBrF,QAAOoJ,OAEC,SAAkBC,EAAMC,GACvCD,EAAKE,OAASD,EACdD,EAAKxD,UAAY7F,OAAOoJ,OAAOE,EAAUzD,WACvC2D,aACEvK,MAAOoK,EACPlJ,YAAY,EACZsJ,UAAU,EACVC,cAAc,MAMH,SAAkBL,EAAMC,GACvCD,EAAKE,OAASD,CACd,IAAIK,GAAW,YACfA,GAAS9D,UAAYyD,EAAUzD,UAC/BwD,EAAKxD,UAAY,GAAI8D,GACrBN,EAAKxD,UAAU2D,YAAcH;;;ACYjC,QAASJ,IAAGW,EAAKC,GACf,GAAIC,EAMJ,OAJEA,GADED,EACS,GAAIX,WAAUU,EAAKC,GAEnB,GAAIX,WAAUU,GAhC7B,GAAIG,QAAS,WAAc,MAAO7J,SAM9BgJ,UAAYa,OAAOb,WAAaa,OAAOC,YAM3C5E,QAAOC,QAAU6D,UAAYD,GAAK,KAyB9BC,YAAWD,GAAGpD,UAAYqD,UAAUrD","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar inherits = require('inherits');\n\nvar packers = require('./packers');\nvar Mapper = require('./Mapper');\n\n\nconst BASE_TIMEOUT = 5000;\n\n\nfunction unifyResponseMethods(responseMethods)\n{\n  if(!responseMethods) return {};\n\n  for(var key in responseMethods)\n  {\n    var value = responseMethods[key];\n\n    if(typeof value == 'string')\n      responseMethods[key] =\n      {\n        response: value\n      }\n  };\n\n  return responseMethods;\n};\n\nfunction unifyTransport(transport)\n{\n  if(!transport) return;\n\n  // Transport as a function\n  if(transport instanceof Function)\n    return {send: transport};\n\n  // WebSocket & DataChannel\n  if(transport.send instanceof Function)\n    return transport;\n\n  // Message API (Inter-window & WebWorker)\n  if(transport.postMessage instanceof Function)\n  {\n    transport.send = transport.postMessage;\n    return transport;\n  }\n\n  // Stream API\n  if(transport.write instanceof Function)\n  {\n    transport.send = transport.write;\n    return transport;\n  }\n\n  // Transports that only can receive messages, but not send\n  if(transport.onmessage !== undefined) return;\n  if(transport.pause instanceof Function) return;\n\n  throw new SyntaxError(\"Transport is not a function nor a valid object\");\n};\n\n\n/**\n * Representation of a RPC notification\n *\n * @class\n *\n * @constructor\n *\n * @param {String} method -method of the notification\n * @param params - parameters of the notification\n */\nfunction RpcNotification(method, params)\n{\n  Object.defineProperty(this, 'method', {value: method, enumerable: true});\n  Object.defineProperty(this, 'params', {value: params, enumerable: true});\n};\n\n\n/**\n * @class\n *\n * @constructor\n *\n * @param {object} packer\n *\n * @param {object} [options]\n *\n * @param {object} [transport]\n *\n * @param {Function} [onRequest]\n */\nfunction RpcBuilder(packer, options, transport, onRequest)\n{\n  var self = this;\n\n  if(!packer)\n    throw new SyntaxError('Packer is not defined');\n\n  if(!packer.pack || !packer.unpack)\n    throw new SyntaxError('Packer is invalid');\n\n  var responseMethods = unifyResponseMethods(packer.responseMethods);\n\n\n  if(options instanceof Function)\n  {\n    if(transport != undefined)\n      throw new SyntaxError(\"There can't be parameters after onRequest\");\n\n    onRequest = options;\n    transport = undefined;\n    options   = undefined;\n  };\n\n  if(options && options.send instanceof Function)\n  {\n    if(transport && !(transport instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n    onRequest = transport;\n    transport = options;\n    options   = undefined;\n  };\n\n  if(transport instanceof Function)\n  {\n    if(onRequest != undefined)\n      throw new SyntaxError(\"There can't be parameters after onRequest\");\n\n    onRequest = transport;\n    transport = undefined;\n  };\n\n  if(transport && transport.send instanceof Function)\n    if(onRequest && !(onRequest instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n  options = options || {};\n\n\n  EventEmitter.call(this);\n\n  if(onRequest)\n    this.on('request', onRequest);\n\n\n  Object.defineProperty(this, 'peerID', {value: options.peerID});\n\n  var max_retries = options.max_retries || 0;\n\n\n  function transportMessage(event)\n  {\n    self.decode(event.data || event);\n  };\n\n  Object.defineProperty(this, 'transport',\n  {\n    get: function()\n    {\n      return transport;\n    },\n\n    set: function(value)\n    {\n      // Remove listener from old transport\n      if(transport)\n      {\n        // W3C transports\n        if(transport.removeEventListener)\n          transport.removeEventListener('message', transportMessage);\n\n        // Node.js Streams API\n        else if(transport.removeListener)\n          transport.removeListener('data', transportMessage);\n      };\n\n      // Set listener on new transport\n      if(value)\n      {\n        // W3C transports\n        if(value.addEventListener)\n          value.addEventListener('message', transportMessage);\n\n        // Node.js Streams API\n        else if(value.addListener)\n          value.addListener('data', transportMessage);\n      };\n\n      transport = unifyTransport(value);\n    }\n  })\n\n  this.transport = transport;\n\n\n  const request_timeout    = options.request_timeout    || BASE_TIMEOUT;\n  const response_timeout   = options.response_timeout   || BASE_TIMEOUT;\n  const duplicates_timeout = options.duplicates_timeout || BASE_TIMEOUT;\n\n\n  var requestID = 0;\n\n  var requests  = new Mapper();\n  var responses = new Mapper();\n  var processedResponses = new Mapper();\n\n  var message2Key = {};\n\n\n  /**\n   * Store the response to prevent to process duplicate request later\n   */\n  function storeResponse(message, id, dest)\n  {\n    var response =\n    {\n      message: message,\n      /** Timeout to auto-clean old responses */\n      timeout: setTimeout(function()\n      {\n        responses.remove(id, dest);\n      },\n      response_timeout)\n    };\n\n    responses.set(response, id, dest);\n  };\n\n  /**\n   * Store the response to ignore duplicated messages later\n   */\n  function storeProcessedResponse(ack, from)\n  {\n    var timeout = setTimeout(function()\n    {\n      processedResponses.remove(ack, from);\n    },\n    duplicates_timeout);\n\n    processedResponses.set(timeout, ack, from);\n  };\n\n\n  /**\n   * Representation of a RPC request\n   *\n   * @class\n   * @extends RpcNotification\n   *\n   * @constructor\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param {Integer} id - identifier of the request\n   * @param [from] - source of the notification\n   */\n  function RpcRequest(method, params, id, from, transport)\n  {\n    RpcNotification.call(this, method, params);\n\n    Object.defineProperty(this, 'transport',\n    {\n      get: function()\n      {\n        return transport;\n      },\n\n      set: function(value)\n      {\n        transport = unifyTransport(value);\n      }\n    })\n\n    var response = responses.get(id, from);\n\n    /**\n     * @constant {Boolean} duplicated\n     */\n    if(!(transport || self.transport))\n      Object.defineProperty(this, 'duplicated',\n      {\n        value: Boolean(response)\n      });\n\n    var responseMethod = responseMethods[method];\n\n    this.pack = packer.pack.bind(packer, this, id)\n\n    /**\n     * Generate a response to this request\n     *\n     * @param {Error} [error]\n     * @param {*} [result]\n     *\n     * @returns {string}\n     */\n    this.reply = function(error, result, transport)\n    {\n      // Fix optional parameters\n      if(error instanceof Function || error && error.send instanceof Function)\n      {\n        if(result != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = error;\n        result = null;\n        error = undefined;\n      }\n\n      else if(result instanceof Function\n      || result && result.send instanceof Function)\n      {\n        if(transport != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = result;\n        result = null;\n      };\n\n      transport = unifyTransport(transport);\n\n      // Duplicated request, remove old response timeout\n      if(response)\n        clearTimeout(response.timeout);\n\n      if(from != undefined)\n      {\n        if(error)\n          error.dest = from;\n\n        if(result)\n          result.dest = from;\n      };\n\n      var message;\n\n      // New request or overriden one, create new response with provided data\n      if(error || result != undefined)\n      {\n        if(self.peerID != undefined)\n        {\n          if(error)\n            error.from = self.peerID;\n          else\n            result.from = self.peerID;\n        }\n\n        // Protocol indicates that responses has own request methods\n        if(responseMethod)\n        {\n          if(responseMethod.error == undefined && error)\n            message =\n            {\n              error: error\n            };\n\n          else\n          {\n            var method = error\n                       ? responseMethod.error\n                       : responseMethod.response;\n\n            message =\n            {\n              method: method,\n              params: error || result\n            };\n          }\n        }\n        else\n          message =\n          {\n            error:  error,\n            result: result\n          };\n\n        message = packer.pack(message, id);\n      }\n\n      // Duplicate & not-overriden request, re-send old response\n      else if(response)\n        message = response.message;\n\n      // New empty reply, response null value\n      else\n        message = packer.pack({result: null}, id);\n\n      // Store the response to prevent to process a duplicated request later\n      storeResponse(message, id, from);\n\n      // Return the stored response so it can be directly send back\n      transport = transport || this.transport || self.transport;\n\n      if(transport)\n        return transport.send(message);\n\n      return message;\n    }\n  };\n  inherits(RpcRequest, RpcNotification);\n\n\n  function cancel(message)\n  {\n    var key = message2Key[message];\n    if(!key) return;\n\n    delete message2Key[message];\n\n    var request = requests.pop(key.id, key.dest);\n    if(!request) return;\n\n    clearTimeout(request.timeout);\n\n    // Start duplicated responses timeout\n    storeProcessedResponse(key.id, key.dest);\n  };\n\n  /**\n   * Allow to cancel a request and don't wait for a response\n   *\n   * If `message` is not given, cancel all the request\n   */\n  this.cancel = function(message)\n  {\n    if(message) return cancel(message);\n\n    for(var message in message2Key)\n      cancel(message);\n  };\n\n\n  this.close = function()\n  {\n    // Prevent to receive new messages\n    var transport = self.transport;\n    if(transport && transport.close)\n       transport.close();\n\n    // Request & processed responses\n    this.cancel();\n\n    processedResponses.forEach(clearTimeout);\n\n    // Responses\n    responses.forEach(function(response)\n    {\n      clearTimeout(response.timeout);\n    });\n  };\n\n\n  /**\n   * Generates and encode a JsonRPC 2.0 message\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param [dest] - destination of the notification\n   * @param {object} [transport] - transport where to send the message\n   * @param [callback] - function called when a response to this request is\n   *   received. If not defined, a notification will be send instead\n   *\n   * @returns {string} A raw JsonRPC 2.0 request or notification string\n   */\n  this.encode = function(method, params, dest, transport, callback)\n  {\n    // Fix optional parameters\n    if(params instanceof Function)\n    {\n      if(dest != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = params;\n      transport = undefined;\n      dest      = undefined;\n      params    = undefined;\n    }\n\n    else if(dest instanceof Function)\n    {\n      if(transport != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = dest;\n      transport = undefined;\n      dest      = undefined;\n    }\n\n    else if(transport instanceof Function)\n    {\n      if(callback != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = transport;\n      transport = undefined;\n    };\n\n    if(self.peerID != undefined)\n    {\n      params = params || {};\n\n      params.from = self.peerID;\n    };\n\n    if(dest != undefined)\n    {\n      params = params || {};\n\n      params.dest = dest;\n    };\n\n    // Encode message\n    var message =\n    {\n      method: method,\n      params: params\n    };\n\n    if(callback)\n    {\n      var id = requestID++;\n      var retried = 0;\n\n      message = packer.pack(message, id);\n\n      function dispatchCallback(error, result)\n      {\n        self.cancel(message);\n\n        callback(error, result);\n      };\n      \n      var request =\n      {\n        message:         message,\n        callback:        dispatchCallback,\n        responseMethods: responseMethods[method] || {}\n      };\n\n      var encode_transport = unifyTransport(transport);\n\n      function sendRequest(transport)\n      {\n        request.timeout = setTimeout(timeout,\n                                     request_timeout*Math.pow(2, retried++));\n        message2Key[message] = {id: id, dest: dest};\n        requests.set(request, id, dest);\n\n        transport = transport || encode_transport || self.transport;\n        if(transport)\n          return transport.send(message);\n\n        return message;\n      };\n\n      function retry(transport)\n      {\n        transport = unifyTransport(transport);\n\n        console.warn(retried+' retry for request message:',message);\n\n        var timeout = processedResponses.pop(id, dest);\n        clearTimeout(timeout);\n\n        return sendRequest(transport);\n      };\n\n      function timeout()\n      {\n        if(retried < max_retries)\n          return retry(transport);\n\n        var error = new Error('Request has timed out');\n            error.request = message;\n\n        error.retry = retry;\n\n        dispatchCallback(error)\n      };\n\n      return sendRequest(transport);\n    };\n\n    // Return the packed message\n    message = packer.pack(message);\n\n    transport = transport || self.transport;\n    if(transport)\n      return transport.send(message);\n\n    return message;\n  };\n\n  /**\n   * Decode and process a JsonRPC 2.0 message\n   *\n   * @param {string} message - string with the content of the message\n   *\n   * @returns {RpcNotification|RpcRequest|undefined} - the representation of the\n   *   notification or the request. If a response was processed, it will return\n   *   `undefined` to notify that it was processed\n   *\n   * @throws {TypeError} - Message is not defined\n   */\n  this.decode = function(message, transport)\n  {\n    if(!message)\n      throw new TypeError(\"Message is not defined\");\n\n    try\n    {\n      message = packer.unpack(message);\n    }\n    catch(e)\n    {\n      // Ignore invalid messages\n      return console.debug(e, message);\n    };\n\n    var id     = message.id;\n    var ack    = message.ack;\n    var method = message.method;\n    var params = message.params || {};\n\n    var from = params.from;\n    var dest = params.dest;\n\n    // Ignore messages send by us\n    if(self.peerID != undefined && from == self.peerID) return;\n\n    // Notification\n    if(id == undefined && ack == undefined)\n    {\n      var notification = new RpcNotification(method, params);\n\n      if(self.emit('request', notification)) return;\n      return notification;\n    };\n\n\n    function processRequest()\n    {\n      // If we have a transport and it's a duplicated request, reply inmediatly\n      transport = unifyTransport(transport) || self.transport;\n      if(transport)\n      {\n        var response = responses.get(id, from);\n        if(response)\n          return transport.send(response.message);\n      };\n\n      var idAck = (id != undefined) ? id : ack;\n      var request = new RpcRequest(method, params, idAck, from, transport);\n\n      if(self.emit('request', request)) return;\n      return request;\n    };\n\n    function processResponse(request, error, result)\n    {\n      request.callback(error, result);\n    };\n\n    function duplicatedResponse(timeout)\n    {\n      console.warn(\"Response already processed\", message);\n\n      // Update duplicated responses timeout\n      clearTimeout(timeout);\n      storeProcessedResponse(ack, from);\n    };\n\n\n    // Request, or response with own method\n    if(method)\n    {\n      // Check if it's a response with own method\n      if(dest == undefined || dest == self.peerID)\n      {\n        var request = requests.get(ack, from);\n        if(request)\n        {\n          var responseMethods = request.responseMethods;\n\n          if(method == responseMethods.error)\n            return processResponse(request, params);\n\n          if(method == responseMethods.response)\n            return processResponse(request, null, params);\n\n          return processRequest();\n        }\n\n        var processed = processedResponses.get(ack, from);\n        if(processed)\n          return duplicatedResponse(processed);\n      }\n\n      // Request\n      return processRequest();\n    };\n\n    var error  = message.error;\n    var result = message.result;\n\n    // Ignore responses not send to us\n    if(error  && error.dest  && error.dest  != self.peerID) return;\n    if(result && result.dest && result.dest != self.peerID) return;\n\n    // Response\n    var request = requests.get(ack, from);\n    if(!request)\n    {\n      var processed = processedResponses.get(ack, from);\n      if(processed)\n        return duplicatedResponse(processed);\n\n      return console.warn(\"No callback was defined for this message\", message);\n    };\n\n    // Process response\n    processResponse(request, error, result);\n  };\n};\ninherits(RpcBuilder, EventEmitter);\n\n\nRpcBuilder.RpcNotification = RpcNotification;\n\n\nmodule.exports = RpcBuilder;\n\nvar clients = require('./clients');\n\nRpcBuilder.clients = clients;\nRpcBuilder.packers = packers;\n","function Mapper()\n{\n  var sources = {};\n\n\n  this.forEach = function(callback)\n  {\n    for(var key in sources)\n    {\n      var source = sources[key];\n\n      for(var key2 in source)\n        callback(source[key2]);\n    };\n  };\n\n  this.get = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return undefined;\n\n    return ids[id];\n  };\n\n  this.remove = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return;\n\n    delete ids[id];\n\n    if(!Object.keys(ids).length)\n      delete sources[source];\n  };\n\n  this.set = function(value, id, source)\n  {\n    if(value == undefined)\n      return this.remove(id, source);\n\n    var ids = sources[source];\n    if(ids == undefined)\n      sources[source] = ids = {};\n\n    ids[id] = value;\n  };\n};\n\n\nMapper.prototype.pop = function(id, source)\n{\n  var value = this.get(id, source);\n  if(value == undefined)\n    return undefined;\n\n  this.remove(id, source);\n\n  return value;\n};\n\n\nmodule.exports = Mapper;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var JsonRPC = require('./JsonRPC');\nvar XmlRPC  = require('./XmlRPC');\n\n\nexports.JsonRPC = JsonRPC;\nexports.XmlRPC  = XmlRPC;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\nvar JsonRpcClient  = require('./jsonrpcclient');\n\n\nexports.JsonRpcClient  = JsonRpcClient;\n","/**\n * JsonRPC 2.0 packer\n */\n\n/**\n * Pack a JsonRPC 2.0 message\n *\n * @param {Object} message - object to be packaged. It requires to have all the\n *   fields needed by the JsonRPC 2.0 message that it's going to be generated\n *\n * @return {String} - the stringified JsonRPC 2.0 message\n */\nfunction pack(message, id)\n{\n  var result =\n  {\n    jsonrpc: \"2.0\"\n  };\n\n  // Request\n  if(message.method)\n  {\n    result.method = message.method;\n\n    if(message.params)\n      result.params = message.params;\n\n    // Request is a notification\n    if(id != undefined)\n      result.id = id;\n  }\n\n  // Response\n  else if(id != undefined)\n  {\n    if(message.error)\n    {\n      if(message.result !== undefined)\n        throw new TypeError(\"Both result and error are defined\");\n\n      result.error = message.error;\n    }\n    else if(message.result !== undefined)\n      result.result = message.result;\n    else\n      throw new TypeError(\"No result or error is defined\");\n\n    result.id = id;\n  };\n\n  return JSON.stringify(result);\n};\n\n/**\n * Unpack a JsonRPC 2.0 message\n *\n * @param {String} message - string with the content of the JsonRPC 2.0 message\n *\n * @throws {TypeError} - Invalid JsonRPC version\n *\n * @return {Object} - object filled with the JsonRPC 2.0 message content\n */\nfunction unpack(message)\n{\n  var result = message;\n\n  if(typeof message == 'string' || message instanceof String)\n    result = JSON.parse(message);\n\n  // Check if it's a valid message\n\n  var version = result.jsonrpc;\n  if(version != \"2.0\")\n    throw new TypeError(\"Invalid JsonRPC version '\"+version+\"': \"+message);\n\n  // Response\n  if(result.method == undefined)\n  {\n    if(result.id == undefined)\n      throw new TypeError(\"Invalid message: \"+message);\n\n    var result_defined = result.result !== undefined;\n    var error_defined  = result.error  !== undefined;\n\n    // Check only result or error is defined, not both or none\n    if(result_defined && error_defined)\n      throw new TypeError(\"Both result and error are defined: \"+message);\n\n    if(!result_defined && !error_defined)\n      throw new TypeError(\"No result or error is defined: \"+message);\n\n    result.ack = result.id;\n    delete result.id;\n  }\n\n  // Return unpacked message\n  return result;\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","function pack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\nfunction unpack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\nvar RpcBuilder = require('../..');\n\nvar WebSocket = require('ws');\n\n\nfunction JsonRpcClient(wsUrl, onRequest, onerror)\n{\n  var ws = new WebSocket(wsUrl);\n      ws.addEventListener('error', onerror);\n\n  var rpc = new RpcBuilder(RpcBuilder.packers.JsonRPC, ws, onRequest);\n\n  this.close       = rpc.close.bind(rpc);\n  this.sendRequest = rpc.encode.bind(rpc);\n};\n\n\nmodule.exports  = JsonRpcClient;\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n"]}